<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="入门案例1、导包 12345678910111213&lt;!-- httpclient --&gt;&lt;dependency&gt;    &lt;groupId&gt;org.apache.httpcomponents&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;httpclient&lt;&#x2F;artifactId&gt;    &lt;version&gt;4">
<meta property="og:type" content="article">
<meta property="og:title" content="java爬虫笔记">
<meta property="og:url" content="http://example.com/2022/06/02/crawler/index.html">
<meta property="og:site_name" content="SupremeSu的博客">
<meta property="og:description" content="入门案例1、导包 12345678910111213&lt;!-- httpclient --&gt;&lt;dependency&gt;    &lt;groupId&gt;org.apache.httpcomponents&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;httpclient&lt;&#x2F;artifactId&gt;    &lt;version&gt;4">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="c:/Users/sjz/AppData/Roaming/Typora/typora-user-images/1641911306398.png">
<meta property="article:published_time" content="2022-06-02T03:29:42.976Z">
<meta property="article:modified_time" content="2022-06-02T03:30:42.252Z">
<meta property="article:author" content="SupremeSu">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="c:/Users/sjz/AppData/Roaming/Typora/typora-user-images/1641911306398.png">

<link rel="canonical" href="http://example.com/2022/06/02/crawler/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>java爬虫笔记 | SupremeSu的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">SupremeSu的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/02/crawler/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="SupremeSu">
      <meta itemprop="description" content="宁愿犯错，也不愿什么都不做">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SupremeSu的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          java爬虫笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-02 11:29:42 / 修改时间：11:30:42" itemprop="dateCreated datePublished" datetime="2022-06-02T11:29:42+08:00">2022-06-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    
      <a title="changyan" href="/2022/06/02/crawler/#SOHUCS" itemprop="discussionUrl">
        <span id="changyan_count_unit" class="post-comments-count hc-comment-count" data-xid="2022/06/02/crawler/" itemprop="commentCount"></span>
      </a>
    
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="入门案例"><a href="#入门案例" class="headerlink" title="入门案例"></a>入门案例</h2><p>1、导包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- httpclient --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- slf4j-log4j12 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、编写log4j.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">DEBUG,AI</span></span><br><span class="line"><span class="attr">log4j.logger.cn.itcast</span> = <span class="string">DEBUG</span></span><br><span class="line"></span><br><span class="line"><span class="attr">log4j.appender.AI</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.AI.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; [%t] [%c]-(%p) | %m%n</span></span><br></pre></td></tr></table></figure>

<p>3、编写代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CrawlerFirst</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1、打开浏览器，创建一个HttpClient对象</span></span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、输入网址，发起get请求创建HttpGet对象</span></span><br><span class="line">        HttpGet httpGet=<span class="keyword">new</span> <span class="title class_">HttpGet</span>(<span class="string">&quot;http://www.itcast.cn&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、按回车，发起请，返回响应，使用HttpClient对象发起请求</span></span><br><span class="line">        <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(httpGet);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、解析响应，获取数据</span></span><br><span class="line">        <span class="comment">//判断状态码是否是200</span></span><br><span class="line">        <span class="keyword">if</span> (response.getStatusLine().getStatusCode()==<span class="number">200</span>)&#123;</span><br><span class="line">            <span class="type">HttpEntity</span> <span class="variable">httpEntity</span> <span class="operator">=</span> response.getEntity();<span class="comment">//获取响应体</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> EntityUtils.toString(httpEntity, <span class="string">&quot;utf8&quot;</span>);</span><br><span class="line">            System.out.println(content);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="HeepClient"><a href="#HeepClient" class="headerlink" title="HeepClient"></a>HeepClient</h2><p>网络爬虫就是用程序帮助我们访问网络上的资源，我们一直以来都是使用HTTP协议访问互联网的网页，网络爬虫需要编写程序，在这里使用同样的HTTP协议访问网页。</p>
<p>这里我们使用Java 的 HTTP协议客户端 HttpClient这个技术，来实现抓取网页数据。</p>
<h3 id="GET-请求"><a href="#GET-请求" class="headerlink" title="GET 请求"></a>GET 请求</h3><p>带参数的get请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.utils.URIBuilder;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.URISyntaxException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpGetParamTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> URISyntaxException &#123;</span><br><span class="line">        <span class="comment">// 1、创建HttpClient对象</span></span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置请求地址：http://yun.itheima.com/search</span></span><br><span class="line">        <span class="comment">// 创建URIBuilder</span></span><br><span class="line">        URIBuilder uriBuilder=<span class="keyword">new</span> <span class="title class_">URIBuilder</span>(<span class="string">&quot;http://yun.itheima.com/search&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置参数，可以设置多个参数后面继续 .setParameter(&quot; “，” “)；</span></span><br><span class="line"><span class="comment">//        uriBuilder.setParameter(&quot;keys&quot;,&quot;Java&quot;).setParameter();</span></span><br><span class="line">        uriBuilder.setParameter(<span class="string">&quot;keys&quot;</span>,<span class="string">&quot;Java&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、创建HttpGet对象，设置url访问地址</span></span><br><span class="line">        <span class="type">HttpGet</span> <span class="variable">httpGet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(uriBuilder.build());</span><br><span class="line"></span><br><span class="line">        CloseableHttpResponse response=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 3、使用HttpClient发起请求，获取response</span></span><br><span class="line">            response = httpClient.execute(httpGet);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4、解析响应</span></span><br><span class="line">            <span class="keyword">if</span> (response.getStatusLine().getStatusCode()==<span class="number">200</span>)&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity(), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                System.out.println(content.length());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//关闭资源</span></span><br><span class="line">                response.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                httpClient.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="POST请求"><a href="#POST请求" class="headerlink" title="POST请求"></a>POST请求</h3><p>不带参数的post请求：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpPost;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpPostTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 1、创建HttpClient对象</span></span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、创建HttpPost对象，设置url访问地址</span></span><br><span class="line">        <span class="type">HttpPost</span> <span class="variable">httpPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(<span class="string">&quot;http://www.itcast.cn&quot;</span>);</span><br><span class="line"></span><br><span class="line">        CloseableHttpResponse response=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 3、使用HttpClient发起请求，获取response</span></span><br><span class="line">            response = httpClient.execute(httpPost);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4、解析响应</span></span><br><span class="line">            <span class="keyword">if</span> (response.getStatusLine().getStatusCode()==<span class="number">200</span>)&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity(), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                System.out.println(content.length());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//关闭资源</span></span><br><span class="line">                response.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                httpClient.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>带参数的post请求：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.jndi.toolkit.url.UrlUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.NameValuePair;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.entity.UrlEncodedFormEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpPost;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.message.BasicNameValuePair;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpPostParamTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1、创建HttpClient对象</span></span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、创建HttpGet对象，设置url访问地址</span></span><br><span class="line">        <span class="type">HttpPost</span> <span class="variable">httpPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(<span class="string">&quot;http://www.itcast.cn&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 声明list集合，封装表单中的参数</span></span><br><span class="line">        List&lt;NameValuePair&gt; params=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;NameValuePair&gt;();</span><br><span class="line">        params.add(<span class="keyword">new</span> <span class="title class_">BasicNameValuePair</span>(<span class="string">&quot;keys&quot;</span>,<span class="string">&quot;Java&quot;</span>));</span><br><span class="line">        <span class="comment">// 创建表单里的Entity对象，第一个参数就是封装好的表单数据，第二个参数就是编码</span></span><br><span class="line">        UrlEncodedFormEntity formEntity=<span class="keyword">new</span> <span class="title class_">UrlEncodedFormEntity</span>(params,<span class="string">&quot;utf8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置表单里的Entity对象到Post请求中</span></span><br><span class="line">        httpPost.setEntity(formEntity);</span><br><span class="line"></span><br><span class="line">        CloseableHttpResponse response=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 3、使用HttpClient发起请求，获取response</span></span><br><span class="line">            response = httpClient.execute(httpPost);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4、解析响应</span></span><br><span class="line">            <span class="keyword">if</span> (response.getStatusLine().getStatusCode()==<span class="number">200</span>)&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity(), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                System.out.println(content.length());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//关闭资源</span></span><br><span class="line">                response.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                httpClient.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="连接池"><a href="#连接池" class="headerlink" title="连接池"></a>连接池</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.conn.PoolingHttpClientConnectionManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">httpClientPoolTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 创建连接池管理器</span></span><br><span class="line">        PoolingHttpClientConnectionManager cm=<span class="keyword">new</span> <span class="title class_">PoolingHttpClientConnectionManager</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置最大连接数</span></span><br><span class="line">        cm.setMaxTotal(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置每个主机的最大连接数</span></span><br><span class="line">        cm.setDefaultMaxPerRoute(<span class="number">10</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用连接池管理器发起请求</span></span><br><span class="line">        doGet(cm);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(PoolingHttpClientConnectionManager cm)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 不是每次创建新的httpClient，而是从连接池中获取httpClient对象</span></span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.custom().setConnectionManager(cm).build();</span><br><span class="line">        <span class="type">HttpGet</span> <span class="variable">httpGet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(<span class="string">&quot;http://www.itcast.cn&quot;</span>);</span><br><span class="line">        CloseableHttpResponse response=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            response = httpClient.execute(httpGet);</span><br><span class="line">            <span class="keyword">if</span> (response.getStatusLine().getStatusCode()==<span class="number">200</span>)&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity(), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                System.out.println(content.length());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (response!=<span class="literal">null</span>)&#123;</span><br><span class="line">                response.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 不能关HttpClient，由连接池管理(重点)</span></span><br><span class="line"><span class="comment">//            httpClient.close();</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="请求参数"><a href="#请求参数" class="headerlink" title="请求参数"></a>请求参数</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.config.RequestConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpConfigTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line">        HttpGet httpGet=<span class="keyword">new</span> <span class="title class_">HttpGet</span>(<span class="string">&quot;http://www.itcast.cn&quot;</span>);</span><br><span class="line">        <span class="comment">// 配置请求信息</span></span><br><span class="line">        <span class="type">RequestConfig</span> <span class="variable">config</span> <span class="operator">=</span> RequestConfig.custom().setConnectTimeout(<span class="number">1000</span>)<span class="comment">// 创建连接的最长时间，单位是毫秒</span></span><br><span class="line">                .setConnectionRequestTimeout(<span class="number">500</span>)   <span class="comment">//设置获取连接的最长时间，毫秒</span></span><br><span class="line">                .setSocketTimeout(<span class="number">10</span>*<span class="number">1000</span>)  <span class="comment">// 设置 数据传输的最长时间</span></span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">// 给请i去设置请求信息</span></span><br><span class="line">        httpGet.setConfig(config);</span><br><span class="line">        CloseableHttpResponse response=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            response = httpClient.execute(httpGet);</span><br><span class="line">            <span class="keyword">if</span> (response.getStatusLine().getStatusCode()==<span class="number">200</span>)&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity(), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                System.out.println(content.length());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            response.close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Jsoup"><a href="#Jsoup" class="headerlink" title="Jsoup"></a>Jsoup</h2><p>jsoup是一款Java的HTML解析器，可直接解析某个URL地址、HTML文内容。它提供了一套非常省力的 API，可通过DOM，cSS以及类似于jQuery的操作方法来取出和操作数据。</p>
<p>jsoup的主要功能如下：</p>
<ul>
<li>从一个URL，文件或者字符串中解析HTML</li>
<li>使用DOM或者CSS 选择器来查找、取出数据</li>
<li>可操作HTML元素、属性、文本</li>
</ul>
<p>1、导包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 抓取网页数据httpclient --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 日志 slf4j-log4j12 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            &lt;scope&gt;test&lt;/scope&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- jsoup --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jsoup<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsoup<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.13.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 测试 junit --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- commons-io --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- commons-lang3 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>PS:<strong>虽然使用Jsoup可以替代HttpClient直接发起请求解析数据，但是往往不会这样用，因为实际的开发过程中，需要使用到多线程，连接池，代理等等方式，而 jsoup对这些的支持并不是很好，所以我们一般把jsoup仅仅作为Html解析工具使用。</strong></p>
<h3 id="解析url"><a href="#解析url" class="headerlink" title="解析url"></a>解析url</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUrl</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="comment">// 解析url地址，第一个参数是访问的url，第二个参数是访问时候的超时时间</span></span><br><span class="line">    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> Jsoup.parse(<span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://www.itcast.cn&quot;</span>), <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用标签选择器，获取title标签中的内容</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> document.getElementsByTag(<span class="string">&quot;title&quot;</span>).first().text();</span><br><span class="line">    System.out.println(title);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="解析字符串"><a href="#解析字符串" class="headerlink" title="解析字符串"></a>解析字符串</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testString</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="comment">// 使用工具类读取文件，获取字符串</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> FileUtils.readFileToString(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;&quot;</span>), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    <span class="comment">//解析字符串</span></span><br><span class="line">    <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> Jsoup.parse(content);</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> doc.getElementsByTag(<span class="string">&quot;title&quot;</span>).first().text();</span><br><span class="line">    System.out.println(title);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="解析文件"><a href="#解析文件" class="headerlink" title="解析文件"></a>解析文件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFile</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="comment">// 解析文件</span></span><br><span class="line">    <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> Jsoup.parse(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;&quot;</span>), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> doc.getElementsByTag(<span class="string">&quot;title&quot;</span>).first().text();</span><br><span class="line">    System.out.println(title);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用DOM方式遍历文档"><a href="#使用DOM方式遍历文档" class="headerlink" title="使用DOM方式遍历文档"></a>使用DOM方式遍历文档</h3><blockquote>
<p> 元素获取</p>
</blockquote>
<ul>
<li>根据id查询元素 getElementById</li>
<li>根据标签获取元素 getElementsByTag</li>
<li>根据class 获取元素 getElementsByClass</li>
<li>根据属性获取元素 getElementsByAttribute</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDOM</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="comment">// 解析文件，获取Document对象</span></span><br><span class="line">    <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> Jsoup.parse(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:\\IDEA\\document\\spider\\src\\main\\template\\test.html&quot;</span>), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//        - 根据id查询元素 getElementById</span></span><br><span class="line">    <span class="type">Element</span> <span class="variable">element</span> <span class="operator">=</span> doc.getElementById(<span class="string">&quot;city_bj&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;通过getElementById获取元素：&quot;</span>+element.text());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//        - 根据标签获取元素 getElementsByTag</span></span><br><span class="line">    Element element1= doc.getElementsByTag(<span class="string">&quot;span&quot;</span>).first();</span><br><span class="line">    System.out.println(<span class="string">&quot;通过getElementsByTag获取的元素：&quot;</span>+element1.text());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//        - 根据class 获取元素 getElementsByClass</span></span><br><span class="line">    <span class="type">Element</span> <span class="variable">element2</span> <span class="operator">=</span> doc.getElementsByClass(<span class="string">&quot;class_a&quot;</span>).first();</span><br><span class="line">    System.out.println(<span class="string">&quot;通过getElementsByClass获取元素：&quot;</span>+element2.text());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//        - 根据属性获取元素 getElementsByAttribute</span></span><br><span class="line">    <span class="type">Element</span> <span class="variable">element3</span> <span class="operator">=</span> doc.getElementsByAttribute(<span class="string">&quot;abc&quot;</span>).first();</span><br><span class="line">    System.out.println(<span class="string">&quot;通过getElementsByAttribute获取元素：&quot;</span>+element3.text());</span><br><span class="line">    <span class="type">Element</span> <span class="variable">element4</span> <span class="operator">=</span> doc.getElementsByAttributeValue(<span class="string">&quot;href&quot;</span>, <span class="string">&quot;http://sh.itcast.cn&quot;</span>).first();</span><br><span class="line">    System.out.println(<span class="string">&quot;通过getElementsByAttributeValue获取元素：&quot;</span>+element4.text());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    通过getElementById获取元素：北京中心</span></span><br><span class="line"><span class="comment">    通过getElementsByTag获取的元素：北京</span></span><br><span class="line"><span class="comment">    通过getElementsByClass获取元素：北京</span></span><br><span class="line"><span class="comment">    通过getElementsByAttribute获取元素：广州</span></span><br><span class="line"><span class="comment">    通过getElementsByAttributeValue获取元素：上海</span></span><br><span class="line"><span class="comment">**/</span></span><br></pre></td></tr></table></figure>

<p>测试的html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>传智播客官网<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;city&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">id</span>=<span class="string">&quot;city_bj&quot;</span>&gt;</span>北京中心<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;city_in&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;city_con&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">&quot;test&quot;</span> <span class="attr">class</span>=<span class="string">&quot;class_a class_b&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.itcast.cn&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;s_name&quot;</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://sh.itcast.cn&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;s_name&quot;</span>&gt;</span>上海<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://gz.itcast.cn&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">abc</span>=<span class="string">&quot;abc&quot;</span> <span class="attr">class</span>=<span class="string">&quot;s_name&quot;</span>&gt;</span>广州<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span>天津<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>元素中获取数据：</p>
</blockquote>
<ul>
<li>从元素中获取id</li>
<li>从元素中获取className</li>
<li>从元素中获取属性的值</li>
<li>从元素中获取所有属性 attributes</li>
<li>从元素中获取文本内容 text</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testData</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="comment">//解析文件 获取Document对象</span></span><br><span class="line">    <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> Jsoup.parse(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:\\IDEA\\document\\spider\\src\\main\\template\\test.html&quot;</span>),<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    <span class="comment">//根据id获取元素</span></span><br><span class="line">    <span class="type">Element</span> <span class="variable">element</span> <span class="operator">=</span> doc.getElementById(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;element: &quot;</span>+element);</span><br><span class="line">    String str=<span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//        - 从元素中获取id</span></span><br><span class="line">    str=element.id();</span><br><span class="line">    System.out.println(<span class="string">&quot;id=&quot;</span>+str);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//        - 从元素中获取className</span></span><br><span class="line">    str=element.className();</span><br><span class="line">    System.out.println(<span class="string">&quot;className=&quot;</span>+str);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//        - 从元素中获取属性的值</span></span><br><span class="line">    str = element.attr(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;通过属性的名字获取：&quot;</span>+str);</span><br><span class="line">    <span class="comment">//        - 从元素中获取所有属性 attributes</span></span><br><span class="line">    <span class="type">Attributes</span> <span class="variable">attributes</span> <span class="operator">=</span> element.attributes();</span><br><span class="line">    System.out.println(<span class="string">&quot;通过attributes获取：&quot;</span>+attributes.toString());</span><br><span class="line">    <span class="comment">//        - 从元素中获取文本内容 text</span></span><br><span class="line">    str = element.text();</span><br><span class="line">    System.out.println(<span class="string">&quot;text(): &quot;</span>+str);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">element: &lt;li id=&quot;test&quot; class=&quot;class_a class_b&quot;&gt; &lt;a href=&quot;http://www.itcast.cn&quot; target=&quot;_blank&quot;&gt; &lt;span class=&quot;s_name&quot;&gt;北京&lt;/span&gt; &lt;/a&gt; &lt;/li&gt;</span></span><br><span class="line"><span class="comment">id=test</span></span><br><span class="line"><span class="comment">className=class_a class_b</span></span><br><span class="line"><span class="comment">通过属性的名字获取：test</span></span><br><span class="line"><span class="comment">通过attributes获取： id=&quot;test&quot; class=&quot;class_a class_b&quot;</span></span><br><span class="line"><span class="comment">text(): 北京</span></span><br><span class="line"><span class="comment">/*</span></span><br></pre></td></tr></table></figure>

<h3 id="selector选择器"><a href="#selector选择器" class="headerlink" title="selector选择器"></a>selector选择器</h3><ul>
<li><code>tagname</code>：通过标签查找元素，如：span</li>
<li><code>#id</code>：通过id查找元素，如：#city_bj</li>
<li><code>.class</code>：通过class名称查找元素，如：.class_a</li>
<li><code>[attibute]</code>：利用属性查找元素，如：[abc]  【必须加括号】</li>
<li><code>[attr=value]</code>：利用属性值来查找元素，如：[class&#x3D;s_name]，【必须加括号】</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelector</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> Jsoup.parse(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:\\IDEA\\document\\spider\\src\\main\\template\\test.html&quot;</span>),<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    <span class="comment">//        - tagname：通过标签查找元素，如：span</span></span><br><span class="line">    <span class="type">Elements</span> <span class="variable">elements</span> <span class="operator">=</span> doc.select(<span class="string">&quot;span&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (Element element : elements) &#123;</span><br><span class="line">        System.out.println(element.text());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//        - #id：通过id查找元素，如：#city_bj</span></span><br><span class="line">    <span class="type">Element</span> <span class="variable">element</span> <span class="operator">=</span> doc.select(<span class="string">&quot;#city_bj&quot;</span>).first();</span><br><span class="line">    System.out.println(<span class="string">&quot;通过id获取：&quot;</span>+element.text());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//        - .class：通过class名称查找元素，如：.class_a</span></span><br><span class="line">    <span class="type">Element</span> <span class="variable">element1</span> <span class="operator">=</span> doc.select(<span class="string">&quot;.class_a&quot;</span>).first();</span><br><span class="line">    System.out.println(element1.text());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//        - [attibute]：利用属性查找元素，如：[abc]，注意必须加括号</span></span><br><span class="line">    <span class="type">Element</span> <span class="variable">element2</span> <span class="operator">=</span> doc.select(<span class="string">&quot;[abc]&quot;</span>).first();</span><br><span class="line">    System.out.println(element2.text());</span><br><span class="line">    <span class="comment">//        - [attr=value]：利用属性值来查找元素，如：[class=s_name]</span></span><br><span class="line">    <span class="type">Elements</span> <span class="variable">elements1</span> <span class="operator">=</span> doc.select(<span class="string">&quot;[class=s_name]&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (Element element3 : elements1) &#123;</span><br><span class="line">        System.out.println(element3);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">北京</span></span><br><span class="line"><span class="comment">上海</span></span><br><span class="line"><span class="comment">广州</span></span><br><span class="line"><span class="comment">通过id获取：北京中心</span></span><br><span class="line"><span class="comment">北京</span></span><br><span class="line"><span class="comment">广州</span></span><br><span class="line"><span class="comment">&lt;span class=&quot;s_name&quot;&gt;北京&lt;/span&gt;</span></span><br><span class="line"><span class="comment">&lt;span class=&quot;s_name&quot;&gt;上海&lt;/span&gt;</span></span><br><span class="line"><span class="comment">&lt;span abc=&quot;abc&quot; class=&quot;s_name&quot;&gt;广州&lt;/span&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Process finished with exit code 0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="selector-选择器组合使用"><a href="#selector-选择器组合使用" class="headerlink" title="selector 选择器组合使用"></a>selector 选择器组合使用</h3><ul>
<li>el#id：元素+id，比如：h3#city_bj</li>
<li>el.class：元素+class，如：li.class_a</li>
<li>任意组合：如：span[abc].s_name</li>
<li>ancestor child：<strong>查找某个元素下子元素</strong>，如：city_con li 查找“city_con”下的所有li<strong>【中间是空格】</strong></li>
<li>parent &gt; child：<strong>查找某个父元素下的直接子元素</strong>，如：.city_con &gt; ul &gt; li 查找city_con 第一级（直接子元素）的ul，再找所有ul下的第一季lli</li>
<li>parent &gt; <em>：*<em>查找某个父元素下的所有直接子元素</em></em></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelector2</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> Jsoup.parse(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:\\IDEA\\document\\spider\\src\\main\\template\\test.html&quot;</span>),<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    <span class="comment">//        - el#id：元素+id，比如：h3#city_bj</span></span><br><span class="line">    <span class="type">Element</span> <span class="variable">element</span> <span class="operator">=</span> doc.select(<span class="string">&quot;h3#city_bj&quot;</span>).first();</span><br><span class="line">    System.out.println(element.text());</span><br><span class="line">    <span class="comment">//        - el.class：元素+class，如：li.class_a</span></span><br><span class="line">    element=doc.selectFirst(<span class="string">&quot;li.class_a&quot;</span>);</span><br><span class="line">    System.out.println(element.text());</span><br><span class="line">    <span class="comment">//        - 任意组合：如：span[abc].s_name</span></span><br><span class="line">    element=doc.select(<span class="string">&quot;span[abc]&quot;</span>).first();</span><br><span class="line">    System.out.println(element.text());</span><br><span class="line">    element=doc.selectFirst(<span class="string">&quot;span[abc].s_name&quot;</span>);</span><br><span class="line">    System.out.println(element.text());</span><br><span class="line">    <span class="comment">//        - ancestor child：查找某个元素下子元素，如：city_con li 查找“city_con”下的所有li</span></span><br><span class="line">    <span class="type">Elements</span> <span class="variable">elements1</span> <span class="operator">=</span> doc.select(<span class="string">&quot;.city_con li&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (Element element1 : elements1) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;空格遍历的结果：&quot;</span>+element1.text());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//        - parent &gt; child：查找某个父元素下的直接子元素，如：.city_con &gt; ul &gt; li 查找city_con 第一级（直接子元素）的ul，再找所有ul下的第一季lli</span></span><br><span class="line">    elements1=doc.select(<span class="string">&quot;.city_con &gt;ul&gt;li&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (Element element1 : elements1) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;&gt;遍历：&quot;</span>+element1.text());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//        - parent &gt; *：查找某个父元素下的所有直接子元素</span></span><br><span class="line">    elements1=doc.select(<span class="string">&quot;.city_con&gt;ul&gt;*&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (Element element1 : elements1) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;*遍历: &quot;</span>+element1.text());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">北京中心</span></span><br><span class="line"><span class="comment">北京</span></span><br><span class="line"><span class="comment">广州</span></span><br><span class="line"><span class="comment">广州</span></span><br><span class="line"><span class="comment">空格遍历的结果：北京</span></span><br><span class="line"><span class="comment">空格遍历的结果：上海</span></span><br><span class="line"><span class="comment">空格遍历的结果：广州</span></span><br><span class="line"><span class="comment">空格遍历的结果：天津</span></span><br><span class="line"><span class="comment">&gt;遍历：北京</span></span><br><span class="line"><span class="comment">&gt;遍历：上海</span></span><br><span class="line"><span class="comment">&gt;遍历：广州</span></span><br><span class="line"><span class="comment">*遍历: 北京</span></span><br><span class="line"><span class="comment">*遍历: 上海</span></span><br><span class="line"><span class="comment">*遍历: 广州</span></span><br><span class="line"><span class="comment">*遍历: 天津</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Process finished with exit code 0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="爬虫案例"><a href="#爬虫案例" class="headerlink" title="爬虫案例"></a>爬虫案例</h2><p>结合HttpClient和Jsoup写一个案例</p>
<p>1、导包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  springMVC--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- httpclient --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- jsoup --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jsoup<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsoup<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.13.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- commons-lang3 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、编写配置<code>application.properties</code></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#DB Configuration:</span></span><br><span class="line"><span class="attr">spring.datasource.driverClassName</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/spider?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#JPA Configuration:</span></span><br><span class="line"><span class="attr">spring.jpa.database</span>=<span class="string">MySQL</span></span><br><span class="line"><span class="attr">spring.jpa.show-sql</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<p>3、编写pojo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sjz.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;jd_item&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Item</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;<span class="comment">//主键</span></span><br><span class="line">    <span class="keyword">private</span> Long spu;<span class="comment">//标准产品单位</span></span><br><span class="line">    <span class="keyword">private</span> Long sku;<span class="comment">//库存量单位</span></span><br><span class="line">    <span class="keyword">private</span> String title;<span class="comment">//商品标题</span></span><br><span class="line">    <span class="keyword">private</span> Double price;<span class="comment">//商品价格</span></span><br><span class="line">    <span class="keyword">private</span> String pic;<span class="comment">//商品图片</span></span><br><span class="line">    <span class="keyword">private</span> String url;<span class="comment">//商品详情地址</span></span><br><span class="line">    <span class="keyword">private</span> Date created;<span class="comment">//创建时间（Date导util的包，不然后面会报错）</span></span><br><span class="line">    <span class="keyword">private</span> Date updated;<span class="comment">//更新时间</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getSpu</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> spu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSpu</span><span class="params">(Long spu)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.spu = spu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getSku</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sku;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSku</span><span class="params">(Long sku)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sku = sku;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTitle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> title;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTitle</span><span class="params">(String title)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.title = title;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getPrice</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrice</span><span class="params">(Double price)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPic</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pic;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPic</span><span class="params">(String pic)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pic = pic;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUrl</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUrl</span><span class="params">(String url)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.url = url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getCreated</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> created;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCreated</span><span class="params">(Date created)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.created = created;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getUpdated</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> updated;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUpdated</span><span class="params">(Date updated)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.updated = updated;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>4、编写dao层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sjz.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sjz.pojo.Item;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ItemDao</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Item,Long&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>5、编写service层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sjz.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sjz.pojo.Item;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ItemService</span> &#123;</span><br><span class="line">    <span class="comment">//保存商品</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Item item)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询商品</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Item&gt; <span class="title function_">findAll</span><span class="params">(Item item)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>impl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sjz.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sjz.dao.ItemDao;</span><br><span class="line"><span class="keyword">import</span> com.sjz.pojo.Item;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Example;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.transaction.Transactional;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ItemServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ItemService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ItemDao itemDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Item item)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.itemDao.save(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Item&gt; <span class="title function_">findAll</span><span class="params">(Item item)</span> &#123;</span><br><span class="line">        <span class="comment">//声明查询条件</span></span><br><span class="line">        Example&lt;Item&gt; example =Example.of(item);</span><br><span class="line">        <span class="comment">//根据查询条件进行查询数据</span></span><br><span class="line">        List&lt;Item&gt; list = <span class="built_in">this</span>.itemDao.findAll(example);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>6、编写utils类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sjz.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.config.RequestConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.conn.PoolingHttpClientConnectionManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> PoolingHttpClientConnectionManager cm;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HttpUtils</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 设置连接池</span></span><br><span class="line">        <span class="built_in">this</span>.cm = <span class="keyword">new</span> <span class="title class_">PoolingHttpClientConnectionManager</span>();</span><br><span class="line">        <span class="comment">// 设置最大连接数</span></span><br><span class="line">        <span class="built_in">this</span>.cm.setMaxTotal(<span class="number">100</span>);</span><br><span class="line">        <span class="comment">// 设置每个主机的最大连接数</span></span><br><span class="line">        <span class="built_in">this</span>.cm.setDefaultMaxPerRoute(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据请求地址下载页面</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 页面数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doGetHtml</span><span class="params">(String url)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取httpClient对象</span></span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.custom().setConnectionManager(<span class="built_in">this</span>.cm).build();</span><br><span class="line">        <span class="comment">// 创建httpGet对象，设置url地址</span></span><br><span class="line">        <span class="type">HttpGet</span> <span class="variable">httpGet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(url);</span><br><span class="line">        <span class="comment">//设置请求信息</span></span><br><span class="line">        httpGet.setConfig(<span class="built_in">this</span>.getConfig());</span><br><span class="line">        <span class="comment">//设置请求头（必须要，不然会返回登录页面）</span></span><br><span class="line">        httpGet.setHeader(<span class="string">&quot;user-agent&quot;</span>,<span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36 Edg/96.0.1054.62&quot;</span>);</span><br><span class="line">        <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 使用httpClient发起请求，获取响应</span></span><br><span class="line">            response = httpClient.execute(httpGet);</span><br><span class="line">            <span class="comment">// 解析响应，返回结果</span></span><br><span class="line">            <span class="keyword">if</span> (response.getStatusLine().getStatusCode()==<span class="number">200</span>)&#123;</span><br><span class="line">                <span class="comment">// 判断响应体Entity是否不为空，如果不为空就可以使用EntityUtils</span></span><br><span class="line">                <span class="keyword">if</span> (response.getEntity()!=<span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity(), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> content;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 关闭response</span></span><br><span class="line">            <span class="keyword">if</span> (response!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    response.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 返回空串</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下载图片</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 图片名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doGetImage</span><span class="params">(String url)</span> &#123;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 获取httpClient对象</span></span><br><span class="line">            <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.custom().setConnectionManager(<span class="built_in">this</span>.cm).build();</span><br><span class="line">            <span class="comment">// 创建httpGet对象，设置url地址</span></span><br><span class="line">            <span class="type">HttpGet</span> <span class="variable">httpGet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(url);</span><br><span class="line">            <span class="comment">//设置请求信息</span></span><br><span class="line">            httpGet.setConfig(<span class="built_in">this</span>.getConfig());</span><br><span class="line">            <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 使用httpClient发起请求，获取响应</span></span><br><span class="line">                response = httpClient.execute(httpGet);</span><br><span class="line">                <span class="comment">// 解析响应，返回结果</span></span><br><span class="line">                <span class="keyword">if</span> (response.getStatusLine().getStatusCode()==<span class="number">200</span>)&#123;</span><br><span class="line">                    <span class="comment">// 判断响应体Entity是否不为空，如果不为空就可以使用EntityUtils</span></span><br><span class="line">                    <span class="keyword">if</span> (response.getEntity()!=<span class="literal">null</span>)&#123;</span><br><span class="line">                        <span class="comment">// 下载图片</span></span><br><span class="line">                        <span class="comment">// 获取图片的后缀</span></span><br><span class="line">                        String extName=url.substring(url.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">                        <span class="comment">// 创建图片名，重命名图片</span></span><br><span class="line">                        String picName= UUID.randomUUID().toString()+extName;</span><br><span class="line">                        <span class="comment">// 下载图片</span></span><br><span class="line">                        <span class="comment">// 声明OutPutStream</span></span><br><span class="line">                        OutputStream outputStream=<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(</span><br><span class="line">                                <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:\\IDEA\\document\\spider-jd\\src\\main\\resources\\static\\images\\&quot;</span>+picName));</span><br><span class="line">                        response.getEntity().writeTo(outputStream);</span><br><span class="line">                        <span class="comment">// 返回图片名称</span></span><br><span class="line">                        <span class="keyword">return</span> picName;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">// 关闭response</span></span><br><span class="line">                <span class="keyword">if</span> (response!=<span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        response.close();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 如果下载失败，返回空串</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置请求的信息</span></span><br><span class="line">    <span class="keyword">private</span> RequestConfig <span class="title function_">getConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">RequestConfig</span> <span class="variable">config</span> <span class="operator">=</span> RequestConfig.custom()</span><br><span class="line">                .setConnectTimeout(<span class="number">1000</span>)    <span class="comment">//创建连接的最长时间</span></span><br><span class="line">                .setConnectionRequestTimeout(<span class="number">500</span>)   <span class="comment">//获取连接的最长时间</span></span><br><span class="line">                .setSocketTimeout(<span class="number">10000</span>)    <span class="comment">//数据传输的最长时间</span></span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>7、编写task层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sjz.task;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.sjz.pojo.Item;</span><br><span class="line"><span class="keyword">import</span> com.sjz.service.ItemService;</span><br><span class="line"><span class="keyword">import</span> com.sjz.utils.HttpUtils;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.Jsoup;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.nodes.Document;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.nodes.Element;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.select.Elements;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ItemTask</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HttpUtils httpUtils;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ItemService itemService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ObjectMapper</span> <span class="variable">MAPPER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当下载任务完成后，间隔多长时间j进行下一次任务</span></span><br><span class="line">    <span class="meta">@Scheduled(fixedDelay = 100 * 1000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">itemTask</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 声明需要解析的初始地址</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;https://search.jd.com/Search?keyword=%E6%89%8B%E6%9C%BA&amp;wq=%E6%89%8B%E6%9C%BA&amp;pvid=b520a78292464614b05aa3a7a665590f&amp;s=116&amp;click=0&amp;page=&quot;</span>;</span><br><span class="line">        <span class="comment">// 按照页面对手机的搜索结果进行遍历</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">5</span>; i = i + <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">html</span> <span class="operator">=</span> httpUtils.doGetHtml(url + i);</span><br><span class="line">            <span class="comment">// 解析页面，获取商品数据并存储</span></span><br><span class="line">            <span class="built_in">this</span>.parse(html);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;手机数据抓取成功!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//解析页面，获取商品数据并存储</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">parse</span><span class="params">(String html)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 解析html获取document</span></span><br><span class="line">        <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> Jsoup.parse(html);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取spu</span></span><br><span class="line">        <span class="type">Elements</span> <span class="variable">spuEles</span> <span class="operator">=</span> doc.select(<span class="string">&quot;div#J_goodsList&gt;ul&gt;li&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Element spuEle : spuEles) &#123;</span><br><span class="line">            <span class="comment">//获取spu</span></span><br><span class="line">            <span class="type">long</span> spu;</span><br><span class="line">            <span class="keyword">if</span> (spuEle.attr(<span class="string">&quot;data-spu&quot;</span>).equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">                spu = <span class="number">0L</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                spu = Long.parseLong(spuEle.attr(<span class="string">&quot;data-spu&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取sku信息</span></span><br><span class="line">            <span class="type">Elements</span> <span class="variable">skuEles</span> <span class="operator">=</span> spuEle.select(<span class="string">&quot;li.ps-item&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (Element skuEle : skuEles) &#123;</span><br><span class="line">                <span class="comment">// 获取sku</span></span><br><span class="line">                <span class="type">long</span> <span class="variable">sku</span> <span class="operator">=</span> Long.parseLong(skuEle.select(<span class="string">&quot;[data-sku]&quot;</span>).attr(<span class="string">&quot;data-sku&quot;</span>));</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 根据sku查询商品数据</span></span><br><span class="line">                <span class="type">Item</span> <span class="variable">item</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Item</span>();</span><br><span class="line">                item.setSku(sku);</span><br><span class="line">                List&lt;Item&gt; list = <span class="built_in">this</span>.itemService.findAll(item);</span><br><span class="line">                <span class="keyword">if</span> (list.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">// 如果商品存在，就进行下一个循环，该商品不保存</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 设置商品的spu</span></span><br><span class="line">                item.setSpu(spu);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 获取商品的详情的url</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">itemUrl</span> <span class="operator">=</span> <span class="string">&quot;https://item.jd.com/&quot;</span> + sku + <span class="string">&quot;.html&quot;</span>;</span><br><span class="line">                item.setUrl(itemUrl);</span><br><span class="line">                <span class="comment">// 获取商品的图片</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">picUrl</span> <span class="operator">=</span> <span class="string">&quot;https:&quot;</span> + skuEle.select(<span class="string">&quot;img[data-sku]&quot;</span>).first().attr(<span class="string">&quot;data-lazy-img&quot;</span>);</span><br><span class="line">                picUrl = picUrl.replace(<span class="string">&quot;/n1/&quot;</span>, <span class="string">&quot;/n9/&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">picName</span> <span class="operator">=</span> <span class="built_in">this</span>.httpUtils.doGetImage(picUrl);</span><br><span class="line">                item.setPic(picName);</span><br><span class="line">                <span class="comment">// 获取商品的价格</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">priceJson</span> <span class="operator">=</span> <span class="built_in">this</span>.httpUtils.doGetHtml(<span class="string">&quot;https://p.3.cn/prices/mgets?skuIds=J_&quot;</span> + sku);</span><br><span class="line">                <span class="type">double</span> <span class="variable">price</span> <span class="operator">=</span> MAPPER.readTree(priceJson).get(<span class="number">0</span>).get(<span class="string">&quot;p&quot;</span>).asDouble();</span><br><span class="line">                item.setPrice(price);</span><br><span class="line">                <span class="comment">// 获取商品的标题</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">itemInfo</span> <span class="operator">=</span> <span class="built_in">this</span>.httpUtils.doGetHtml(item.getUrl());</span><br><span class="line">                <span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> Jsoup.parse(itemInfo).select(<span class="string">&quot;div.sku-name&quot;</span>).text();</span><br><span class="line">                item.setTitle(title);</span><br><span class="line"></span><br><span class="line">                item.setCreated(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">                item.setUpdated(item.getCreated());</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 保存商品数据到数据库中</span></span><br><span class="line">                <span class="built_in">this</span>.itemService.save(item);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>8、编写启动类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sjz;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableScheduling;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">//使用定时任务，需要先开启定时任务，需要添加注解</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="WebMagic"><a href="#WebMagic" class="headerlink" title="WebMagic"></a>WebMagic</h1><h2 id="入门案例-1"><a href="#入门案例-1" class="headerlink" title="入门案例"></a>入门案例</h2><p>1、导包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>us.codecraft<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>webmagic-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>us.codecraft<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>webmagic-extension<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、编写log4j.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Global logging configuration 开发时候建议使用 debug</span></span><br><span class="line"><span class="comment">#log4j.rootLogger=DEBUG, stdout</span></span><br><span class="line"><span class="comment">## Console output...</span></span><br><span class="line"><span class="comment">#log4j.appender.stdout=org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="comment">#log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="comment">#log4j.appender.stdout.layout.ConversionPattern=%-d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; [%t] [%c]-[%p] %m%n</span></span><br></pre></td></tr></table></figure>

<p>3、编写主程序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tedu.webwagic.test1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.Page;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.Site;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.Spider;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.processor.PageProcessor;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现PageProcessor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JobProcessor</span> <span class="keyword">implements</span> <span class="title class_">PageProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 解析页面</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(Page page)</span> &#123;</span><br><span class="line">        page.addTargetRequests(page.getHtml().css(<span class="string">&quot;div.pagelist&quot;</span>).links().all());</span><br><span class="line">        page.putField(<span class="string">&quot;title&quot;</span>,page.getHtml().css(<span class="string">&quot;div.news_conent_two_title&quot;</span>).all());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Site site=Site.me()</span><br><span class="line">            .setCharset(<span class="string">&quot;utf8&quot;</span>) <span class="comment">// 设置编码格式</span></span><br><span class="line">            .setTimeOut(<span class="number">1000</span>); <span class="comment">//设置超时时间，单位：毫秒</span></span><br><span class="line"><span class="comment">//            .setRetrySleepTime(3000)    // 设置重试间隔时间</span></span><br><span class="line"><span class="comment">//            .setSleepTime(3);   // 设置重试次数</span></span><br><span class="line">    <span class="keyword">public</span> Site <span class="title function_">getSite</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> site;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 主函数，执行爬虫</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Spider.create(<span class="keyword">new</span> <span class="title class_">JobProcessor</span>())</span><br><span class="line">                .addUrl(<span class="string">&quot;http://www.njtc.edu.cn/pagelist-04c1bae78fa647459772d695ba01c45d.html&quot;</span>) <span class="comment">// 解析的地址</span></span><br><span class="line"><span class="comment">//                .addPipeline(new FilePipeline(&quot;文件的路径&quot;))  // 文件输出，不写的话默认是ConsolePipeline</span></span><br><span class="line">                .thread(<span class="number">5</span>)  <span class="comment">// 多线程处理</span></span><br><span class="line">                .run(); <span class="comment">//执行</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p> 官网：<a target="_blank" rel="noopener" href="http://webmagic.io/">WebMagic</a> </p>
<h2 id="WebMagic介绍"><a href="#WebMagic介绍" class="headerlink" title="WebMagic介绍"></a>WebMagic介绍</h2><h3 id="WebMagic介绍-1"><a href="#WebMagic介绍-1" class="headerlink" title="WebMagic介绍"></a>WebMagic介绍</h3><p>WebMagic项目代码分为核心和扩展两部分。核心部分(webmagic-core)是一个精简的、模块化的爬虫实现，而扩展部分则包括一些便利的、实用性的功能。WebMagic的架构设计参照了Scrapy，目标是尽量的模块化，并体现爬虫的功能特点。</p>
<p>这部分提供非常简单、灵活的API，在基本不改变开发模式的情况下，编写一个爬虫。</p>
<p>扩展部分(webmagic-extension)提供一些便捷的功能，例如注解模式编写爬虫等。同时内置了一些常用的组件，便于爬虫开发。</p>
<p>另外WebMagic还包括一些外围扩展和一个正在开发的产品化项目<code>webmagic-avalon</code>。</p>
<h3 id="架构介绍"><a href="#架构介绍" class="headerlink" title="架构介绍"></a>架构介绍</h3><p>WebMagic 的结构分为Downloader、PageProcessor、Scheduler、Pipeline 四大组件,并由 Spider将它们彼此组织起来。这四大组件对应爬虫生命周期中的下载、处理、管理和持久化等功能。WebMagic的设计参考了Scapy，但是实现方式更Java 化一些。</p>
<p><img src="C:\Users\sjz\AppData\Roaming\Typora\typora-user-images\1641911306398.png" alt="1641911306398"></p>
<h3 id="WebMagic的四个组件"><a href="#WebMagic的四个组件" class="headerlink" title="WebMagic的四个组件"></a>WebMagic的四个组件</h3><blockquote>
<p>1.Downloader</p>
</blockquote>
<p>Downloader负责从互联网上下载页面，以便后续处理。WebMagic默认使用了<a target="_blank" rel="noopener" href="http://hc.apache.org/index.html">Apache HttpClient</a>作为下载工具。</p>
<blockquote>
<p>2.PageProcessor</p>
</blockquote>
<p>PageProcessor负责解析页面，抽取有用信息，以及发现新的链接。WebMagic使用<a target="_blank" rel="noopener" href="http://jsoup.org/">Jsoup</a>作为HTML解析工具，并基于其开发了解析XPath的工具<a target="_blank" rel="noopener" href="https://github.com/code4craft/xsoup">Xsoup</a>。</p>
<p>在这四个组件中，<code>PageProcessor</code>对于每个站点每个页面都不一样，是需要使用者定制的部分。</p>
<blockquote>
<p>3.Scheduler</p>
</blockquote>
<p>Scheduler负责管理待抓取的URL，以及一些去重的工作。WebMagic默认提供了JDK的内存队列来管理URL，并用集合来进行去重。也支持使用Redis进行分布式管理。</p>
<p>除非项目有一些特殊的分布式需求，否则无需自己定制Scheduler。</p>
<blockquote>
<p>4.Pipeline</p>
</blockquote>
<p>Pipeline负责抽取结果的处理，包括计算、持久化到文件、数据库等。WebMagic默认提供了“输出到控制台”和“保存到文件”两种结果处理方案。</p>
<p><code>Pipeline</code>定义了结果保存的方式，如果你要保存到指定数据库，则需要编写对应的Pipeline。对于一类需求一般只需编写一个<code>Pipeline</code>。</p>
<h3 id="用于数据流转的对象"><a href="#用于数据流转的对象" class="headerlink" title="用于数据流转的对象"></a>用于数据流转的对象</h3><h4 id="1-Request"><a href="#1-Request" class="headerlink" title="1. Request"></a>1. Request</h4><p><code>Request</code>是对URL地址的一层封装，一个Request对应一个URL地址。</p>
<p>它是PageProcessor与Downloader交互的载体，也是PageProcessor控制Downloader唯一方式。</p>
<p>除了URL本身外，它还包含一个Key-Value结构的字段<code>extra</code>。你可以在extra中保存一些特殊的属性，然后在其他地方读取，以完成不同的功能。例如附加上一个页面的一些信息等。</p>
<h4 id="2-Page"><a href="#2-Page" class="headerlink" title="2. Page"></a>2. Page</h4><p><code>Page</code>代表了从Downloader下载到的一个页面——可能是HTML，也可能是JSON或者其他文本格式的内容。</p>
<p>Page是WebMagic抽取过程的核心对象，它提供一些方法可供抽取、结果保存等。在第四章的例子中，我们会详细介绍它的使用。</p>
<h4 id="3-ResultItems"><a href="#3-ResultItems" class="headerlink" title="3. ResultItems"></a>3. ResultItems</h4><p><code>ResultItems</code>相当于一个Map，它保存PageProcessor处理的结果，供Pipeline使用。它的API与Map很类似，值得注意的是它有一个字段<code>skip</code>，若设置为true，则不应被Pipeline处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">page.putField(key,field);	<span class="comment">// 将field存放到key中</span></span><br><span class="line">resultItems.get(<span class="string">&quot;key&quot;</span>);		<span class="comment">// 取出key中的值</span></span><br></pre></td></tr></table></figure>



<h2 id="编写基本的爬虫"><a href="#编写基本的爬虫" class="headerlink" title="编写基本的爬虫"></a>编写基本的爬虫</h2><h3 id="实现PageProcessor"><a href="#实现PageProcessor" class="headerlink" title="实现PageProcessor"></a>实现PageProcessor</h3><p>将PageProcessor的定制分为三个部分，分别是<strong>爬虫的配置、页面元素的抽取和链接的发现</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GithubRepoPageProcessor</span> <span class="keyword">implements</span> <span class="title class_">PageProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 部分一：抓取网站的相关配置，包括编码、抓取间隔、重试次数等</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Site</span> <span class="variable">site</span> <span class="operator">=</span> Site.me().setRetryTimes(<span class="number">3</span>).setSleepTime(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">// process是定制爬虫逻辑的核心接口，在这里编写抽取逻辑</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(Page page)</span> &#123;</span><br><span class="line">        <span class="comment">// 部分二：定义如何抽取页面信息，并保存下来</span></span><br><span class="line">        page.putField(<span class="string">&quot;author&quot;</span>, page.getUrl().regex(<span class="string">&quot;https://github\\.com/(\\w+)/.*&quot;</span>).toString());</span><br><span class="line">        page.putField(<span class="string">&quot;name&quot;</span>, page.getHtml().xpath(<span class="string">&quot;//h1[@class=&#x27;entry-title public&#x27;]/strong/a/text()&quot;</span>).toString());</span><br><span class="line">        <span class="keyword">if</span> (page.getResultItems().get(<span class="string">&quot;name&quot;</span>) == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//skip this page</span></span><br><span class="line">            page.setSkip(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        page.putField(<span class="string">&quot;readme&quot;</span>, page.getHtml().xpath(<span class="string">&quot;//div[@id=&#x27;readme&#x27;]/tidyText()&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 部分三：从页面发现后续的url地址来抓取</span></span><br><span class="line">        page.addTargetRequests(page.getHtml().links().regex(<span class="string">&quot;(https://github\\.com/[\\w\\-]+/[\\w\\-]+)&quot;</span>).all());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Site <span class="title function_">getSite</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> site;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        Spider.create(<span class="keyword">new</span> <span class="title class_">GithubRepoPageProcessor</span>())</span><br><span class="line">                <span class="comment">//从&quot;https://github.com/code4craft&quot;开始抓</span></span><br><span class="line">                .addUrl(<span class="string">&quot;https://github.com/code4craft&quot;</span>)</span><br><span class="line">                <span class="comment">//开启5个线程抓取</span></span><br><span class="line">                .thread(<span class="number">5</span>)</span><br><span class="line">                <span class="comment">//启动爬虫</span></span><br><span class="line">                .run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="爬虫的配置"><a href="#爬虫的配置" class="headerlink" title="爬虫的配置"></a>爬虫的配置</h4><p>第一部分关于爬虫的配置，包括编码、抓取间隔、超时时间、重试次数等，也包括一些模拟的参数，例如User Agent、cookie，以及代理的设置，我们会在第5章-“爬虫的配置”里进行介绍。在这里我们先简单设置一下：重试次数为3次，抓取间隔为一秒。</p>
<h4 id="页面元素的抽取"><a href="#页面元素的抽取" class="headerlink" title="页面元素的抽取"></a>页面元素的抽取</h4><p>第二部分是爬虫的核心部分：对于下载到的Html页面，你如何从中抽取到你想要的信息？WebMagic里主要使用了三种抽取技术：XPath、正则表达式和CSS选择器。另外，对于JSON格式的内容，可使用JsonPath进行解析。</p>
<ol>
<li><p>XPath</p>
<p>XPath本来是用于XML中获取元素的一种查询语言，但是用于Html也是比较方便的。例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">page.getHtml().xpath(<span class="string">&quot;//h1[@class=&#x27;entry-title public&#x27;]/strong/a/text()&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>这段代码使用了XPath，它的意思是“查找所有class属性为’entry-title public’的h1元素，并找到他的strong子节点的a子节点，并提取a节点的文本信息”。 </p>
</li>
<li><p>CSS选择器</p>
<p>CSS选择器是与XPath类似的语言。如果大家做过前端开发，肯定知道$(‘h1.entry-title’)这种写法的含义。客观的说，它比XPath写起来要简单一些，但是如果写复杂一点的抽取规则，就相对要麻烦一点。</p>
</li>
<li><p>正则表达式</p>
<p>正则表达式则是一种通用的文本抽取语言。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">page.addTargetRequests(page.getHtml().links().regex(<span class="string">&quot;(https://github\\.com/\\w+/\\w+)&quot;</span>).all());</span><br></pre></td></tr></table></figure>

<p>这段代码就用到了正则表达式，它表示匹配所有”<a target="_blank" rel="noopener" href="https://github.com/code4craft/webmagic&quot;%E8%BF%99%E6%A0%B7%E7%9A%84%E9%93%BE%E6%8E%A5%E3%80%82">https://github.com/code4craft/webmagic&quot;这样的链接。</a></p>
</li>
<li><p>JsonPath</p>
<p>JsonPath是于XPath很类似的一个语言，它用于从Json中快速定位一条内容。WebMagic中使用的JsonPath格式可以参考这里：<a target="_blank" rel="noopener" href="https://code.google.com/p/json-path/">https://code.google.com/p/json-path/</a></p>
</li>
</ol>
<h4 id="链接的发现"><a href="#链接的发现" class="headerlink" title="链接的发现"></a>链接的发现</h4><p>有了处理页面的逻辑，我们的爬虫就接近完工了！</p>
<p>但是现在还有一个问题：一个站点的页面是很多的，一开始我们不可能全部列举出来，于是如何发现后续的链接，是一个爬虫不可缺少的一部分。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">page.addTargetRequests(page.getHtml().links().regex(<span class="string">&quot;(https://github\\.com/\\w+/\\w+)&quot;</span>).all());</span><br></pre></td></tr></table></figure>

<p>这段代码的分为两部分，<code>page.getHtml().links().regex(&quot;(https://github\\.com/\\w+/\\w+)&quot;).all()</code>用于获取所有满足”(https:&#x2F; &#x2F;github.com&#x2F;\w+&#x2F;\w+)”这个正则表达式的链接，&#x3D;&#x3D;<code>page.addTargetRequests()</code>则将这些链接加入到待抓取的队列中去&#x3D;&#x3D;。</p>
<h3 id="使用Selectable抽取元素"><a href="#使用Selectable抽取元素" class="headerlink" title="使用Selectable抽取元素"></a>使用Selectable抽取元素</h3><p><code>Selectable</code>相关的抽取元素链式API是WebMagic的一个核心功能。使用Selectable接口，你可以直接完成页面元素的链式抽取，也无需去关心抽取的细节。</p>
<p>page.getHtml()返回的是一个<code>Html</code>对象，它实现了<code>Selectable</code>接口。这个接口包含一些重要的方法，将它分为两类：<strong>抽取部分和获取结果部分</strong>。</p>
<h4 id="抽取部分API："><a href="#抽取部分API：" class="headerlink" title="抽取部分API："></a>抽取部分API：</h4><table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>xpath(String xpath)</td>
<td>使用XPath选择</td>
<td>html.xpath(“&#x2F;&#x2F;div[@class&#x3D;’title’]”)</td>
</tr>
<tr>
<td>$(String selector)</td>
<td>使用Css选择器选择</td>
<td>html.$(“div.title”)</td>
</tr>
<tr>
<td>$(String selector,String attr)</td>
<td>使用Css选择器选择，返回attr的属性值</td>
<td>html.$(“div.title”,”text”)</td>
</tr>
<tr>
<td>css(String selector)</td>
<td>功能同$()，使用Css选择器选择</td>
<td>html.css(“div.title”)</td>
</tr>
<tr>
<td>css(String selector,String attr)</td>
<td>使用Css选择器选择，返回attr的属性值</td>
<td>html.css(“a”,”href”)</td>
</tr>
<tr>
<td>links()</td>
<td>选择所有链接</td>
<td>html.links()</td>
</tr>
<tr>
<td>regex(String regex)</td>
<td>使用正则表达式抽取</td>
<td>html.regex(“(.*?)&quot;)</td>
</tr>
<tr>
<td>regex(String regex,int group)</td>
<td>使用正则表达式抽取，并指定捕获组</td>
<td>html.regex(“(.*?)&quot;,1)</td>
</tr>
<tr>
<td>replace(String regex, String replacement)</td>
<td>替换内容</td>
<td>html.replace(“&quot;,””)</td>
</tr>
</tbody></table>
<p>这部分抽取API返回的都是一个<code>Selectable</code>接口，意思是说，抽取是支持链式调用的。下面我用一个实例来讲解链式API的使用。</p>
<p>那么我可以先用CSS选择器提取出这个div，然后在取到所有的链接。为了保险起见，我再使用正则表达式限定一下提取出的URL的格式，那么最终的写法是这样子的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; urls = page.getHtml().css(<span class="string">&quot;div.pagination&quot;</span>).links().regex(<span class="string">&quot;.*/search/\?l=java.*&quot;</span>).all();</span><br></pre></td></tr></table></figure>

<p>然后，我们可以把这些URL加到抓取列表中去：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; urls = page.getHtml().css(<span class="string">&quot;div.pagination&quot;</span>).links().regex(<span class="string">&quot;.*/search/\?l=java.*&quot;</span>).all();</span><br><span class="line">page.addTargetRequests(urls);</span><br></pre></td></tr></table></figure>

<p>是不是比较简单？除了发现链接，Selectable的链式抽取还可以完成很多工作。我们会在第9章示例中再讲到。</p>
<h4 id="获取结果的API："><a href="#获取结果的API：" class="headerlink" title="获取结果的API："></a>获取结果的API：</h4><p>当链式调用结束时，我们一般都想要拿到一个字符串类型的结果。这时候就需要用到获取结果的API了。我们知道，一条抽取规则，无论是XPath、CSS选择器或者正则表达式，总有可能抽取到多条元素。WebMagic对这些进行了统一，你可以通过不同的API获取到一个或者多个元素。</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>get()</td>
<td>返回一条String类型的结果</td>
<td>String link&#x3D; html.links().get()</td>
</tr>
<tr>
<td>toString()</td>
<td>功能同get()，返回一条String类型的结果</td>
<td>String link&#x3D; html.links().toString()</td>
</tr>
<tr>
<td>all()</td>
<td>返回所有抽取结果</td>
<td>List links&#x3D; html.links().all()</td>
</tr>
<tr>
<td>match()</td>
<td>是否有匹配结果</td>
<td>if (html.links().match()){ xxx; }</td>
</tr>
</tbody></table>
<p>例如，我们知道页面只会有一条结果，那么可以使用selectable.get()或者selectable.toString()拿到这条结果。</p>
<p>这里selectable.toString()采用了toString()这个接口，是为了在输出以及和一些框架结合的时候，更加方便。因为一般情况下，我们都只需要选择一个元素！</p>
<p>selectable.all()则会获取到所有元素。</p>
<h3 id="使用Pipeline保存结果"><a href="#使用Pipeline保存结果" class="headerlink" title="使用Pipeline保存结果"></a>使用Pipeline保存结果</h3><p>好了，爬虫编写完成，现在我们可能还有一个问题：我如果想把抓取的结果保存下来，要怎么做呢？WebMagic用于保存结果的组件叫做<code>Pipeline</code>。例如我们通过“控制台输出结果”这件事也是通过一个内置的Pipeline完成的，它叫做<code>ConsolePipeline</code>。那么，我现在想要把结果用Json的格式保存下来，怎么做呢？我只需要将Pipeline的实现换成”JsonFilePipeline”就可以了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    Spider.create(<span class="keyword">new</span> <span class="title class_">GithubRepoPageProcessor</span>())</span><br><span class="line">            <span class="comment">//从&quot;https://github.com/code4craft&quot;开始抓</span></span><br><span class="line">            .addUrl(<span class="string">&quot;https://github.com/code4craft&quot;</span>)</span><br><span class="line">            .addPipeline(<span class="keyword">new</span> <span class="title class_">JsonFilePipeline</span>(<span class="string">&quot;D:\\webmagic\\&quot;</span>))</span><br><span class="line">            <span class="comment">//开启5个线程抓取</span></span><br><span class="line">            .thread(<span class="number">5</span>)</span><br><span class="line">            <span class="comment">//启动爬虫</span></span><br><span class="line">            .run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样子下载下来的文件就会保存在D盘的webmagic目录中了。</p>
<p>通过定制Pipeline，我们还可以实现保存结果到文件、数据库等一系列功能。</p>
<h3 id="爬虫的配置、启动和终止"><a href="#爬虫的配置、启动和终止" class="headerlink" title="爬虫的配置、启动和终止"></a>爬虫的配置、启动和终止</h3><blockquote>
<p>Spider</p>
</blockquote>
<p><code>Spider</code>是爬虫启动的入口。在启动爬虫之前，我们需要使用一个<code>PageProcessor</code>创建一个Spider对象，然后使用<code>run()</code>进行启动。同时Spider的其他组件（Downloader、Scheduler、Pipeline）都可以通过set方法来进行设置。</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>create(PageProcessor)</td>
<td>创建Spider</td>
<td>Spider.create(new GithubRepoProcessor())</td>
</tr>
<tr>
<td>addUrl(String…)</td>
<td>添加初始的URL</td>
<td>spider .addUrl(“<a target="_blank" rel="noopener" href="http://webmagic.io/docs/&quot;">http://webmagic.io/docs/&quot;</a>)</td>
</tr>
<tr>
<td>addRequest(Request…)</td>
<td>添加初始的Request</td>
<td>spider .addRequest(“<a target="_blank" rel="noopener" href="http://webmagic.io/docs/&quot;">http://webmagic.io/docs/&quot;</a>)</td>
</tr>
<tr>
<td>thread(n)</td>
<td>开启n个线程</td>
<td>spider.thread(5)</td>
</tr>
<tr>
<td>run()</td>
<td>启动，会阻塞当前线程执行</td>
<td>spider.run()</td>
</tr>
<tr>
<td>start()&#x2F;runAsync()</td>
<td>异步启动，当前线程继续执行</td>
<td>spider.start()</td>
</tr>
<tr>
<td>stop()</td>
<td>停止爬虫</td>
<td>spider.stop()</td>
</tr>
<tr>
<td>test(String)</td>
<td>抓取一个页面进行测试</td>
<td>spider .test(“<a target="_blank" rel="noopener" href="http://webmagic.io/docs/&quot;">http://webmagic.io/docs/&quot;</a>)</td>
</tr>
<tr>
<td>addPipeline(Pipeline)</td>
<td>添加一个Pipeline，一个Spider可以有多个Pipeline</td>
<td>spider .addPipeline(new ConsolePipeline())</td>
</tr>
<tr>
<td>setScheduler(Scheduler)</td>
<td>设置Scheduler，一个Spider只能有个一个Scheduler</td>
<td>spider.setScheduler(new RedisScheduler())</td>
</tr>
<tr>
<td>setDownloader(Downloader)</td>
<td>设置Downloader，一个Spider只能有个一个Downloader</td>
<td>spider .setDownloader(new SeleniumDownloader())</td>
</tr>
<tr>
<td>get(String)</td>
<td>同步调用，并直接取得结果</td>
<td>ResultItems result &#x3D; spider .get(“<a target="_blank" rel="noopener" href="http://webmagic.io/docs/&quot;">http://webmagic.io/docs/&quot;</a>)</td>
</tr>
<tr>
<td>getAll(String…)</td>
<td>同步调用，并直接取得一堆结果</td>
<td>List<ResultItems> results &#x3D; spider .getAll(“<a target="_blank" rel="noopener" href="http://webmagic.io/docs/&quot;">http://webmagic.io/docs/&quot;</a>, “<a target="_blank" rel="noopener" href="http://webmagic.io/xxx&quot;">http://webmagic.io/xxx&quot;</a>)</td>
</tr>
</tbody></table>
<blockquote>
<p>Site</p>
</blockquote>
<p>对站点本身的一些配置信息，例如编码、HTTP头、超时时间、重试策略等、代理等，都可以通过设置<code>Site</code>对象来进行配置。</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>setCharset(String)</td>
<td>设置编码</td>
<td>site.setCharset(“utf-8”)</td>
</tr>
<tr>
<td>setUserAgent(String)</td>
<td>设置UserAgent</td>
<td>site.setUserAgent(“Spider”)</td>
</tr>
<tr>
<td>setTimeOut(int)</td>
<td>设置超时时间，单位是毫秒</td>
<td>site.setTimeOut(3000)</td>
</tr>
<tr>
<td>setRetryTimes(int)</td>
<td>设置重试次数</td>
<td>site.setRetryTimes(3)</td>
</tr>
<tr>
<td>setCycleRetryTimes(int)</td>
<td>设置循环重试次数</td>
<td>site.setCycleRetryTimes(3)</td>
</tr>
<tr>
<td>addCookie(String,String)</td>
<td>添加一条cookie</td>
<td>site.addCookie(“dotcomt_user”,”code4craft”)</td>
</tr>
<tr>
<td>setDomain(String)</td>
<td>设置域名，需设置域名后，addCookie才可生效</td>
<td>site.setDomain(“github.com”)</td>
</tr>
<tr>
<td>addHeader(String,String)</td>
<td>添加一条addHeader</td>
<td>site.addHeader(“Referer”,”<a target="_blank" rel="noopener" href="https://github.com/">https://github.com</a>“)</td>
</tr>
<tr>
<td>setHttpProxy(HttpHost)</td>
<td>设置Http代理</td>
<td>site.setHttpProxy(new HttpHost(“127.0.0.1”,8080))</td>
</tr>
</tbody></table>
<h3 id="配置代理-beta"><a href="#配置代理-beta" class="headerlink" title="配置代理(beta)"></a>配置代理(beta)</h3><p>因为场景的多样性，代理这部分API一直处于不稳定状态，但是因为需求确实存在，所以WebMagic会继续支持代理部分的完善。目前发布的API只是beta版，后续API可能会有更改。代理相关的设置都在Site类中。</p>
<table>
<thead>
<tr>
<th>API</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Site.setHttpProxy(HttpHost httpProxy)</td>
<td>设置单一的普通HTTP代理</td>
</tr>
<tr>
<td>Site.setUsernamePasswordCredentials(UsernamePasswordCredentials usernamePasswordCredentials)</td>
<td>为HttpProxy设置账号密码</td>
</tr>
<tr>
<td>Site.setHttpProxyPool(List\ httpProxyList, boolean isUseLastProxy)</td>
<td>设置代理池</td>
</tr>
</tbody></table>
<p>代理示例：</p>
<ol>
<li>设置单一的普通HTTP代理为101.101.101.101的8888端口，并设置密码为”username”,”password”</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">site.setHttpProxy(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;101.101.101.101&quot;</span>,<span class="number">8888</span>))</span><br><span class="line">    .setUsernamePasswordCredentials(<span class="keyword">new</span> <span class="title class_">UsernamePasswordCredentials</span>(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;password&quot;</span>));</span><br></pre></td></tr></table></figure>

<ol>
<li>设置代理池，其中包括101.101.101.101和102.102.102.102两个IP</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String[]&gt; poolHosts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String[]&gt;();</span><br><span class="line">poolHosts.add(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;username&quot;</span>,<span class="string">&quot;password&quot;</span>,<span class="string">&quot;101.101.101.101&quot;</span>,<span class="string">&quot;8888&quot;</span>&#125;);</span><br><span class="line">poolHosts.add(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;username&quot;</span>,<span class="string">&quot;password&quot;</span>,<span class="string">&quot;102.102.102.102&quot;</span>,<span class="string">&quot;8888&quot;</span>&#125;);</span><br><span class="line"><span class="comment">//httpProxyList输入是IP+PORT, isUseLastProxy是指重启时是否使用上一次的代理配置</span></span><br><span class="line">site.setHttpProxyPool(poolHosts,<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p>0.6.0版本后，允许实现自己的代理池，通过扩展接口<code>ProxyPool</code>来实现。目前WebMagic的代理池逻辑是：轮流使用代理池中的IP，如果某个IP失败超过20次则增加2小时的重用时间，具体实现可以参考<code>SimpleProxyPool</code>。</p>
<blockquote>
<p>使用代理</p>
</blockquote>
<p>WebMagic 使用的代理 APIProxyProvider。因为相对于Site 的”配置“，ProxyProvider 定位更多是一个”组件“，所以代理不再从Site设置，而是由HttpClientDownloader设置</p>
<table>
<thead>
<tr>
<th>API</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>HttpClientDownloader.setProxyProvider(ProxyProvider proxyProvider)</td>
<td>设置代理</td>
</tr>
</tbody></table>
<p>ProxyProvider 有一个默认实现：SimpleProxyProvider。它是一个基于简单Round-Robin的、没有失败检查的ProxyProvider。可以配置任意个候选代理，每次会按顺序挑选一个代理使用。它适合用在自己搭建的比较稳定的代理的场景。</p>
<p>如果需要根据实际使用情况对代理服务器进行管理（例如校验是否可用，定期清理、添加代理服务器等），只需要自己实现APIProxyProvider即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scheduled(fixedDelay=1000)</span> <span class="comment">// 一秒执行一次</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Process</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 创建下载器 Downloader</span></span><br><span class="line">    HttpClientDownloader httpClientDownloader=<span class="keyword">new</span> <span class="title class_">HttpClientDownloader</span>();</span><br><span class="line">    <span class="comment">//给下载器设置代理服务器信息</span></span><br><span class="line">    httpClientDownloader.setProxyProvider(SimpleProxyProvider.from(<span class="keyword">new</span> <span class="title class_">Proxy</span>(<span class="string">&quot;222.74.73.202&quot;</span>,<span class="number">42055</span>)));</span><br><span class="line">    <span class="comment">//给下载器设置代理服务器信息</span></span><br><span class="line">    Spider.create(<span class="keyword">new</span> <span class="title class_">ProxyTest</span>())</span><br><span class="line">        .addUrl(<span class="string">&quot;&quot;</span>)</span><br><span class="line">        ..setDownloader(httpClientDownloader)<span class="comment">// 设置下载器</span></span><br><span class="line">        .run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="组件的使用和定制"><a href="#组件的使用和定制" class="headerlink" title="组件的使用和定制"></a>组件的使用和定制</h2><h3 id="使用和定制Pipeline"><a href="#使用和定制Pipeline" class="headerlink" title="使用和定制Pipeline"></a>使用和定制Pipeline</h3><p>Pileline是抽取结束后，进行处理的部分，它主要用于抽取结果的保存，也可以定制Pileline可以实现一些通用的功能。</p>
<h4 id="Pipeline介绍"><a href="#Pipeline介绍" class="headerlink" title="Pipeline介绍"></a>Pipeline介绍</h4><p>Pipeline的接口定义如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Pipeline</span> &#123;</span><br><span class="line">    <span class="comment">// ResultItems保存了抽取结果，它是一个Map结构，</span></span><br><span class="line">    <span class="comment">// 在page.putField(key,value)中保存的数据，可以通过ResultItems.get(key)获取</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(ResultItems resultItems, Task task)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，<code>Pipeline</code>其实就是将<code>PageProcessor</code>抽取的结果，继续进行了处理的，其实在Pipeline中完成的功能，你基本上也可以直接在PageProcessor实现，那么为什么会有Pipeline？有几个原因：</p>
<ol>
<li><strong>为了模块分离</strong>。“页面抽取”和“后处理、持久化”是爬虫的两个阶段，将其分离开来，一个是代码结构比较清晰，另一个是以后也可能将其处理过程分开，分开在独立的线程以至于不同的机器执行。</li>
<li><strong>Pipeline的功能比较固定，更容易做成通用组件</strong>。每个页面的抽取方式千变万化，但是后续处理方式则比较固定，例如保存到文件、保存到数据库这种操作，这些对所有页面都是通用的。WebMagic中就已经提供了控制台输出、保存到文件、保存为JSON格式的文件几种通用的Pipeline。</li>
</ol>
<p>在WebMagic里，一个<code>Spider</code>可以有多个Pipeline，使用<code>Spider.addPipeline()</code>即可增加一个Pipeline。这些Pipeline都会得到处理，例如你可以使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spider.addPipeline(<span class="keyword">new</span> <span class="title class_">ConsolePipeline</span>()).addPipeline(<span class="keyword">new</span> <span class="title class_">FilePipeline</span>())</span><br></pre></td></tr></table></figure>

<p>实现输出结果到控制台，并且保存到文件的目标。</p>
<h4 id="将结果输出到控制台"><a href="#将结果输出到控制台" class="headerlink" title="将结果输出到控制台"></a>将结果输出到控制台</h4><p>在介绍PageProcessor时，我们使用了<a target="_blank" rel="noopener" href="https://github.com/code4craft/webmagic/blob/master/webmagic-core/src/main/java/us/codecraft/webmagic/processor/example/GithubRepoPageProcessor.java">GithubRepoPageProcessor</a>作为例子，其中某一段代码中，我们将结果进行了保存：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(Page page)</span> &#123;</span><br><span class="line">    page.addTargetRequests(page.getHtml().links().regex(<span class="string">&quot;(https://github\\.com/\\w+/\\w+)&quot;</span>).all());</span><br><span class="line">    page.addTargetRequests(page.getHtml().links().regex(<span class="string">&quot;(https://github\\.com/\\w+)&quot;</span>).all());</span><br><span class="line">    <span class="comment">//保存结果author，这个结果会最终保存到ResultItems中</span></span><br><span class="line">    page.putField(<span class="string">&quot;author&quot;</span>, page.getUrl().regex(<span class="string">&quot;https://github\\.com/(\\w+)/.*&quot;</span>).toString());</span><br><span class="line">    page.putField(<span class="string">&quot;name&quot;</span>, page.getHtml().xpath(<span class="string">&quot;//h1[@class=&#x27;entry-title public&#x27;]/strong/a/text()&quot;</span>).toString());</span><br><span class="line">    <span class="keyword">if</span> (page.getResultItems().get(<span class="string">&quot;name&quot;</span>)==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="comment">//设置skip之后，这个页面的结果不会被Pipeline处理</span></span><br><span class="line">        page.setSkip(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    page.putField(<span class="string">&quot;readme&quot;</span>, page.getHtml().xpath(<span class="string">&quot;//div[@id=&#x27;readme&#x27;]/tidyText()&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们想将结果保存到控制台，要怎么做呢？<a target="_blank" rel="noopener" href="https://github.com/code4craft/webmagic/blob/master/webmagic-core/src/main/java/us/codecraft/webmagic/pipeline/ConsolePipeline.java">ConsolePipeline</a>可以完成这个工作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsolePipeline</span> <span class="keyword">implements</span> <span class="title class_">Pipeline</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(ResultItems resultItems, Task task)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;get page: &quot;</span> + resultItems.getRequest().getUrl());</span><br><span class="line">        <span class="comment">//遍历所有结果，输出到控制台，上面例子中的&quot;author&quot;、&quot;name&quot;、&quot;readme&quot;都是一个key，其结果则是对应的value</span></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; entry : resultItems.getAll().entrySet()) &#123;</span><br><span class="line">            System.out.println(entry.getKey() + <span class="string">&quot;:\t&quot;</span> + entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参考这个例子，你就可以定制自己的Pipeline了——从<code>ResultItems</code>中取出数据，再按照你希望的方式处理即可。</p>
<h4 id="将结果保存到MySQL"><a href="#将结果保存到MySQL" class="headerlink" title="将结果保存到MySQL"></a>将结果保存到MySQL</h4><p>在Java里，我们有很多方式将数据保存到MySQL，例如jdbc、dbutils、spring-jdbc、MyBatis等工具。这些工具都可以完成同样的事情，只不过功能和使用复杂程度不一样。如果使用jdbc，那么我们只需要从ResultItems取出数据，进行保存即可。</p>
<p>如果我们会使用ORM框架来完成持久化到MySQL的工作，就会面临一个问题：这些框架一般都要求保存的内容是一个定义好结构的对象，而不是一个key-value形式的ResultItems。以MyBatis为例，我们使用<a target="_blank" rel="noopener" href="http://mybatis.github.io/spring/zh/">MyBatis-Spring</a>可以定义这样一个DAO：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">JobInfoDAO</span> &#123;</span><br><span class="line">    <span class="meta">@Insert(&quot;insert into JobInfo (`title`,`salary`,`company`,`description`,`requirement`,`source`,`url`,`urlMd5`) values (#&#123;title&#125;,#&#123;salary&#125;,#&#123;company&#125;,#&#123;description&#125;,#&#123;requirement&#125;,#&#123;source&#125;,#&#123;url&#125;,#&#123;urlMd5&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(LieTouJobInfo jobInfo)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们要做的，就是实现一个Pipeline，将ResultItems和<code>LieTouJobInfo</code>对象结合起来。</p>
<h4 id="注解模式"><a href="#注解模式" class="headerlink" title="注解模式"></a>注解模式</h4><p>注解模式下，WebMagic内置了一个<a target="_blank" rel="noopener" href="https://github.com/code4craft/webmagic/blob/master/webmagic-extension/src/main/java/us/codecraft/webmagic/pipeline/PageModelPipeline.java">PageModelPipeline</a>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PageModelPipeline</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="comment">//这里传入的是处理好的对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(T t, Task task)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时，我们可以很优雅的定义一个<a target="_blank" rel="noopener" href="https://github.com/webmagic-io/jobhunter/blob/master/src/main/java/us/codecraft/jobhunter/pipeline/JobInfoDaoPipeline.java">JobInfoDaoPipeline</a>，来实现这个功能：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;JobInfoDaoPipeline&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JobInfoDaoPipeline</span> <span class="keyword">implements</span> <span class="title class_">PageModelPipeline</span>&lt;LieTouJobInfo&gt; &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> JobInfoDAO jobInfoDAO;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(LieTouJobInfo lieTouJobInfo, Task task)</span> &#123;</span><br><span class="line">        <span class="comment">//调用MyBatis DAO保存结果</span></span><br><span class="line">        jobInfoDAO.add(lieTouJobInfo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="基本Pipeline模式"><a href="#基本Pipeline模式" class="headerlink" title="基本Pipeline模式"></a>基本Pipeline模式</h4><p>至此，结果保存就已经完成了！那么如果我们使用原始的Pipeline接口，要怎么完成呢？其实答案也很简单，如果你要保存一个对象，那么就需要在抽取的时候，将它保存为一个对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(Page page)</span> &#123;</span><br><span class="line">    page.addTargetRequests(page.getHtml().links().regex(<span class="string">&quot;(https://github\\.com/\\w+/\\w+)&quot;</span>).all());</span><br><span class="line">    page.addTargetRequests(page.getHtml().links().regex(<span class="string">&quot;(https://github\\.com/\\w+)&quot;</span>).all());</span><br><span class="line">    <span class="type">GithubRepo</span> <span class="variable">githubRepo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GithubRepo</span>();</span><br><span class="line">    githubRepo.setAuthor(page.getUrl().regex(<span class="string">&quot;https://github\\.com/(\\w+)/.*&quot;</span>).toString());</span><br><span class="line">    githubRepo.setName(page.getHtml().xpath(<span class="string">&quot;//h1[@class=&#x27;entry-title public&#x27;]/strong/a/text()&quot;</span>).toString());</span><br><span class="line">    githubRepo.setReadme(page.getHtml().xpath(<span class="string">&quot;//div[@id=&#x27;readme&#x27;]/tidyText()&quot;</span>).toString());</span><br><span class="line">    <span class="keyword">if</span> (githubRepo.getName() == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//skip this page</span></span><br><span class="line">        page.setSkip(<span class="literal">true</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        page.putField(<span class="string">&quot;repo&quot;</span>, githubRepo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在Pipeline中，只要使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">GithubRepo</span> <span class="variable">githubRepo</span> <span class="operator">=</span> (GithubRepo)resultItems.get(<span class="string">&quot;repo&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>就可以获取这个对象了。</p>
<blockquote>
<p>PageModelPipeline实际上也是通过原始的Pipeline来实现的，它将与PageProcessor进行了整合，在保存时，使用类名作为key，而对象则是value，具体实现见：<a target="_blank" rel="noopener" href="https://github.com/code4craft/webmagic/blob/master/webmagic-extension/src/main/java/us/codecraft/webmagic/model/ModelPipeline.java">ModelPipeline</a>。</p>
</blockquote>
<h4 id="WebMagic已经提供的几个Pipeline"><a href="#WebMagic已经提供的几个Pipeline" class="headerlink" title="WebMagic已经提供的几个Pipeline"></a>WebMagic已经提供的几个Pipeline</h4><p>WebMagic中已经提供了将结果输出到控制台、保存到文件和JSON格式保存的几个Pipeline：</p>
<table>
<thead>
<tr>
<th>类</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>ConsolePipeline</td>
<td>输出结果到控制台</td>
<td>抽取结果需要实现toString方法</td>
</tr>
<tr>
<td>FilePipeline</td>
<td>保存结果到文件</td>
<td>抽取结果需要实现toString方法</td>
</tr>
<tr>
<td>JsonFilePipeline</td>
<td>JSON格式保存结果到文件</td>
<td></td>
</tr>
<tr>
<td>ConsolePageModelPipeline</td>
<td>(注解模式)输出结果到控制台</td>
<td></td>
</tr>
<tr>
<td>FilePageModelPipeline</td>
<td>(注解模式)保存结果到文件</td>
<td></td>
</tr>
<tr>
<td>JsonFilePageModelPipeline</td>
<td>(注解模式)JSON格式保存结果到文件</td>
<td>想要持久化的字段需要有getter方法</td>
</tr>
</tbody></table>
<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>Spring中，自己亲自通过new从而实例化出来的对象是不被Spring所管理的。在webMagic的官方实例中，如果要将抓取的数据进行保存的话，需要自己创建一个实现类来实现Pipeline接口，重写其中的process（）方法，在该方法能进行数据保存的操作。问题就在于，在启动爬虫的调用处，该实现类是以new对象的形式传入到addPipeline方法的，因此在该实现类中，通过Autowired注入mapper层对象是无效的，这时候运行起来就会报错。</p>
<p>换句话说，因为定制化Pipeline接口的实现类，本身就是以创建对象的形式传入到addPipeline方法里头被运行的，所以 pipeline 内部本身使用@Autowired注入的话是无效的，会引发空指针.</p>
<p>解决办法是：通过注入来实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">JobPipeLineTest jobPipeLineTest;	<span class="comment">// 注入自定义的pipeline</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Scheduled(initialDelay = 1000,fixedDelay = 10000)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">JobMain</span><span class="params">()</span>&#123;</span><br><span class="line">    Spider.create(<span class="keyword">new</span> <span class="title class_">JobProcessTest</span>())</span><br><span class="line">        .addUrl(<span class="string">&quot;&quot;</span>)</span><br><span class="line">        .addPipeline(jobPipeLineTest)	<span class="comment">// 不能使用new ，只能使用注入的方式</span></span><br><span class="line">        .run(); <span class="comment">// 执行</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="使用和定制Scheduler"><a href="#使用和定制Scheduler" class="headerlink" title="使用和定制Scheduler"></a>使用和定制Scheduler</h3><p>Scheduler是WebMagic中进行URL管理的组件。一般来说，Scheduler包括两个作用：</p>
<ol>
<li><strong>对待抓取的URL队列进行管理。</strong></li>
<li><strong>对已抓取的URL进行去重。</strong></li>
</ol>
<p>WebMagic内置了几个常用的Scheduler。如果你只是在本地执行规模比较小的爬虫，那么基本无需定制Scheduler，但是了解一下已经提供的几个Scheduler还是有意义的。</p>
<table>
<thead>
<tr>
<th>类</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>DuplicateRemovedScheduler</td>
<td>抽象基类，提供一些模板方法</td>
<td>继承它可以实现自己的功能</td>
</tr>
<tr>
<td>QueueScheduler</td>
<td>使用内存队列保存待抓取URL</td>
<td></td>
</tr>
<tr>
<td>PriorityScheduler</td>
<td>使用带有优先级的内存队列保存待抓取URL</td>
<td>耗费内存较QueueScheduler更大，但是当设置了request.priority之后，只能使用PriorityScheduler才可使优先级生效</td>
</tr>
<tr>
<td>FileCacheQueueScheduler</td>
<td>使用文件保存抓取URL，可以在关闭程序并下次启动时，从之前抓取到的URL继续抓取</td>
<td>需指定路径，会建立.urls.txt和.cursor.txt两个文件</td>
</tr>
<tr>
<td>RedisScheduler</td>
<td>使用Redis保存抓取队列，可进行多台机器同时合作抓取</td>
<td>需要安装并启动redis</td>
</tr>
</tbody></table>
<p>在0.5.1版本里，对Scheduler的内部实现进行了重构，去重部分被单独抽象成了一个接口：<code>DuplicateRemover</code>，从而可以为同一个Scheduler选择不同的去重方式，以适应不同的需要，目前提供了两种去重方式。</p>
<table>
<thead>
<tr>
<th>类</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>HashSetDuplicateRemover</td>
<td>使用HashSet来进行去重，占用内存较大</td>
</tr>
<tr>
<td>BloomFilterDuplicateRemover</td>
<td>使用BloomFilter来进行去重，占用内存较小，但是可能漏抓页面</td>
</tr>
</tbody></table>
<p><strong>所有默认的Scheduler都使用HashSetDuplicateRemover来进行去重</strong>，（除开RedisScheduler是使用Redis的set进行去重）。</p>
<p>如果你的URL较多，使用HashSetDuplicateRemover会比较占用内存，所以也可以尝试以下BloomFilterDuplicateRemover，使用方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spider.setScheduler(<span class="keyword">new</span> <span class="title class_">QueueScheduler</span>()</span><br><span class="line">.setDuplicateRemover(<span class="keyword">new</span> <span class="title class_">BloomFilterDuplicateRemover</span>(<span class="number">10000000</span>)) <span class="comment">//10000000是估计的页面数量</span></span><br><span class="line">)	<span class="comment">// setDuplicateRemover设置去重过滤器</span></span><br></pre></td></tr></table></figure>

<p>使用前需要添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- WebMagic 对布隆过滤器的支持 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.guava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guava<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>16.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>三种去重方式的区别</p>
</blockquote>
<ul>
<li><p>HashSet</p>
<p>使用java中的HashSet不能重复的特点去重，优点是容易理解，使用方便；</p>
<p>缺点：占用内存大，性能较低。</p>
</li>
<li><p>Redis去重</p>
<p>使用Redis的set进行去重，优点是速度快，而且去重不会占用爬虫服务器的资源，可以处理更大数据量的数据爬法。</p>
<p>缺点：需要准备Redis服务器，增加开发和使用成本</p>
</li>
<li><p>布隆过滤器</p>
<p>使用布隆过滤器也可以实现去重。优点是占用的内存要比使用HashSet要小得多，也适合大量数据的去重操作。</p>
<p>缺点：有误判的可能。没有重复可能会判定重复，但重复数据一定会判定重复。</p>
</li>
</ul>
<h3 id="使用和定制Downloader"><a href="#使用和定制Downloader" class="headerlink" title="使用和定制Downloader"></a>使用和定制Downloader</h3><p>WebMagic的默认Downloader基于HttpClient。一般来说，你无须自己实现Downloader，不过HttpClientDownloader也预留了几个扩展点，以满足不同场景的需求。</p>
<p>另外，你可能希望通过其他方式来实现页面下载，例如使用<code>SeleniumDownloader</code>来渲染动态页面。</p>
<h2 id="招聘网站爬取完整案例"><a href="#招聘网站爬取完整案例" class="headerlink" title="招聘网站爬取完整案例"></a>招聘网站爬取完整案例</h2><p>1、导包(部分核心依赖)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mysql驱动--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mybatis--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--        webmagic核心包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>us.codecraft<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>webmagic-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--        webMagic扩展包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>us.codecraft<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>webmagic-extension<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、编写pojo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Company</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String companyName;</span><br><span class="line">    <span class="keyword">private</span> String header;</span><br><span class="line">    <span class="keyword">private</span> String jobName;</span><br><span class="line">    <span class="keyword">private</span> String jobArea;</span><br><span class="line">    <span class="keyword">private</span> String salary;</span><br><span class="line">    <span class="keyword">private</span> String jobDescription;</span><br><span class="line">    <span class="keyword">private</span> String companyDescription;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>3、编写Service层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sjz.services;</span><br><span class="line"><span class="keyword">import</span> com.sjz.pojo.Company;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CompanyService</span> &#123;</span><br><span class="line">    <span class="comment">// 保存信息</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">saveInfo</span><span class="params">(Company company)</span>;</span><br><span class="line">    <span class="comment">// 查询所有信息</span></span><br><span class="line">    List&lt;Company&gt; <span class="title function_">QueryInfoAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写serviceimpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sjz.services;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CompanyServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CompanyService</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CompanyMapper companyMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">saveInfo</span><span class="params">(Company company)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> companyMapper.saveInfo(company);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Company&gt; <span class="title function_">QueryInfoAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> companyMapper.QueryInfoAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>4、编写mapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sjz.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sjz.pojo.Company;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span> <span class="comment">// 交给spring管理</span></span><br><span class="line"><span class="meta">@Mapper</span>     <span class="comment">//让spring扫描这里（不加这个注解的话也可以在启动类上加@MapperScan(com.sjz.mapper.CompanyMapper)）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CompanyMapper</span> &#123;</span><br><span class="line">    <span class="comment">// 保存信息</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">saveInfo</span><span class="params">(Company company)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有信息</span></span><br><span class="line">    List&lt;Company&gt; <span class="title function_">QueryInfoAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>编写mapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sjz.mapper.CompanyMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;saveInfo&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.sjz.pojo.Company&quot;</span>&gt;</span></span><br><span class="line">        insert into spider.company (company_name,header,job_name,job_area,salary,job_description,</span><br><span class="line">        company_description) values(#&#123;companyName&#125;,#&#123;header&#125;,#&#123;jobName&#125;,#&#123;jobArea&#125;,#&#123;salary&#125;,</span><br><span class="line">        #&#123;jobDescription&#125;,#&#123;companyDescription&#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;QueryInfoAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.sjz.pojo.Company&quot;</span>&gt;</span></span><br><span class="line">        select * from spider.company;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>5、编写application.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据库配置</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/spider?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mybatis配置</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span>  <span class="comment"># 扫描xxxmapper.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.sjz.pojo</span>    <span class="comment"># 取别名</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span>	<span class="comment"># 开启驼峰式命名</span></span><br></pre></td></tr></table></figure>

<p>6、编写爬虫主函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sjz.task;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sjz.pojo.Company;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.Page;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.Site;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.Spider;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.downloader.HttpClientDownloader;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.processor.PageProcessor;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.proxy.Proxy;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.proxy.SimpleProxyProvider;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.selector.Html;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>  <span class="comment">// 交给spring管理</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JobProcessTest</span> <span class="keyword">implements</span> <span class="title class_">PageProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 只能通过注入来实现pipeline，不然service为失效</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JobPipeLineTest jobPipeLineTest;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Site site=Site.me()</span><br><span class="line">            .setCharset(<span class="string">&quot;utf8&quot;</span>)    <span class="comment">// 设置编码</span></span><br><span class="line">            .setTimeOut(<span class="number">3000</span>)       <span class="comment">// 设置超时延迟</span></span><br><span class="line">            .setUserAgent(<span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36 Edg/97.0.1072.55&quot;</span>)</span><br><span class="line">            .setRetryTimes(<span class="number">3</span>)</span><br><span class="line">            .setSleepTime(<span class="number">0</span>)</span><br><span class="line"><span class="comment">//            .addHeader(&quot;cookie&quot;,&quot;&quot;)	// 添加cookie</span></span><br><span class="line">            ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(Page page)</span> &#123;</span><br><span class="line">        <span class="type">Html</span> <span class="variable">html</span> <span class="operator">=</span> page.getHtml();</span><br><span class="line">        <span class="type">Company</span> <span class="variable">company</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Company</span>();</span><br><span class="line">        <span class="comment">// 搜索链接</span></span><br><span class="line">        page.addTargetRequests(html.css(<span class="string">&quot;div.left-list-box&gt;ul&gt;li&gt;div.job-list-item&gt;div&gt;div&gt;div&gt;a&quot;</span>).links().regex(<span class="string">&quot;https:\\/\\/www\\.liepin\\.com\\/job.+&quot;</span>).all());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//  查看元素</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">header</span> <span class="operator">=</span> html.xpath(<span class="string">&quot;//div[@class=&#x27;name-box&#x27;]/span[@class=&#x27;name&#x27;]/text()&quot;</span>).toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">jobName</span> <span class="operator">=</span> html.xpath(<span class="string">&quot;//span[@class=&#x27;name ellipsis-1&#x27;]/text()&quot;</span>).toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">salary</span> <span class="operator">=</span> html.xpath(<span class="string">&quot;//span[@class=&#x27;salary&#x27;]/text()&quot;</span>).toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">companyDescription</span> <span class="operator">=</span> html.xpath(<span class="string">&quot;//div[@class=&#x27;inner&#x27;]/text()&quot;</span>).toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">companyName</span> <span class="operator">=</span> html.xpath(<span class="string">&quot;//div[@class=&#x27;title-box&#x27;]/span/a/text()&quot;</span>).toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">jobArea</span> <span class="operator">=</span> html.xpath(<span class="string">&quot;//div[@class=&#x27;job-properties&#x27;]/span/text()&quot;</span>).toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">jobDescription</span> <span class="operator">=</span> html.xpath(<span class="string">&quot;//dd[@data-selector=&#x27;job-intro-content&#x27;]/text()&quot;</span>).toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加到company中</span></span><br><span class="line">        company.setJobArea(jobArea);</span><br><span class="line">        company.setCompanyDescription(companyDescription);</span><br><span class="line">        company.setCompanyName(companyName);</span><br><span class="line">        company.setHeader(header);</span><br><span class="line">        company.setJobDescriprion(jobDescription);</span><br><span class="line">        company.setJobName(jobName);</span><br><span class="line">        company.setSalary(salary);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 放入到pipeline中</span></span><br><span class="line">        page.putField(<span class="string">&quot;company&quot;</span>,company);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Site <span class="title function_">getSite</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> site;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(initialDelay = 1000,fixedDelay = 10000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">JobMain</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 创建下载器</span></span><br><span class="line">        <span class="type">HttpClientDownloader</span> <span class="variable">httpClientDownloader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpClientDownloader</span>();</span><br><span class="line">        <span class="comment">// 设置代理</span></span><br><span class="line">        httpClientDownloader.setProxyProvider(SimpleProxyProvider.from(<span class="keyword">new</span> <span class="title class_">Proxy</span>(<span class="string">&quot;165.225.26.84&quot;</span>,<span class="number">10605</span>)));</span><br><span class="line">        Spider.create(<span class="keyword">new</span> <span class="title class_">JobProcessTest</span>())</span><br><span class="line">                .addUrl(<span class="string">&quot;https://www.liepin.com/zhaopin/?headId=2f4bbbbda07d8890ec1257a9212ec77c&amp;ckId=dvdnqb0zqbtr9w04scfgo95cutll5eqa&amp;fkId=v4k48g38xzukg6gf191ugpyws739y558&amp;skId=v4k48g38xzukg6gf191ugpyws739y558&amp;sfrom=search_job_pc&amp;key=java&amp;dq=280020&amp;scene=condition&quot;</span>)</span><br><span class="line"><span class="comment">//                .setDownloader(httpClientDownloader)    // 设置下载器</span></span><br><span class="line">                .addPipeline(jobPipeLineTest)	<span class="comment">//添加自定义pipeline</span></span><br><span class="line">                .run(); <span class="comment">// 执行</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>7、编写自定义pipeline</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sjz.task;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>  <span class="comment">// 交给spring管理</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JobPipeLineTest</span> <span class="keyword">implements</span> <span class="title class_">Pipeline</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CompanyService companyService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(ResultItems resultItems, Task task)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取company信息</span></span><br><span class="line">        <span class="type">Company</span> <span class="variable">company</span> <span class="operator">=</span> resultItems.get(<span class="string">&quot;company&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (company!=<span class="literal">null</span>)&#123;</span><br><span class="line">            companyService.saveInfo(company);	<span class="comment">// 保存信息</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>8、编写主启动类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sjz;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableScheduling;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableScheduling</span>	<span class="comment">// 开启定时任务</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebmagicJobApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(WebmagicJobApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html.xpath(<span class="string">&quot;//ul[@class=&#x27;pList01&#x27;]/li/a/text()&quot;</span>)	<span class="comment">// text()可以获取文本值</span></span><br></pre></td></tr></table></figure>







<h1 id="selenium"><a href="#selenium" class="headerlink" title="selenium"></a>selenium</h1><h2 id="selenium介绍"><a href="#selenium介绍" class="headerlink" title="selenium介绍"></a>selenium介绍</h2><p>selenium家族：</p>
<ul>
<li>Selenium IDE，是Firefox的扩展插件，支持用户录制和回放测试</li>
<li>Selenium WebDriver，提供了各种语言环境的API来支持更多控制权和编写符合标准软件开发实践的应用程序。</li>
<li>SeleniumGrid，分布式自动化工具，可以在多个测试环境中以并发的方式执行测试脚本，实现测试脚本的并发执行，缩短大量的测试脚本的执行时间</li>
</ul>
<h2 id="Selenium-WebDriver"><a href="#Selenium-WebDriver" class="headerlink" title="Selenium WebDriver"></a>Selenium WebDriver</h2><p>用于Web应用程序测试的工具，Selenium是开源并且免费的，ISelenium测试直接在浏览器中运行，就像真实用户所做的一样。<br>支持Java、Python、Net、Perl等编程语言进行自动化测试脚本编写。</p>
<blockquote>
<p>入门案例</p>
</blockquote>
<p>1、导包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>us.codecraft<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>webmagic-selenium<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、编写</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testEdge</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//设置webdriver.edge.driver属性</span></span><br><span class="line">    System.setProperty(<span class="string">&quot;webdriver.edge.driver&quot;</span>,<span class="string">&quot;driver/msedgedriver.exe&quot;</span>);  </span><br><span class="line">    <span class="type">EdgeDriver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EdgeDriver</span>();<span class="comment">//打开edge浏览器</span></span><br><span class="line">    driver.get(<span class="string">&quot;https://www.baidu.com/&quot;</span>); 	<span class="comment">//打开百度</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="元素定位"><a href="#元素定位" class="headerlink" title="元素定位"></a>元素定位</h2><h3 id="基本元素定位"><a href="#基本元素定位" class="headerlink" title="基本元素定位"></a>基本元素定位</h3><ul>
<li>id：根据id来获取元素，返回单个元素</li>
<li>name：根据元素的name属性来获取元素，可能会返回元素集合</li>
<li>tagName：根据元素的标签名来获取元素，可能会返回元素集合</li>
<li>className：根据元素的样式class值来获取元素，可能返回元素集合</li>
<li>linkText：根据超链接的文本值来获取元素</li>
<li>partialLinkText：根据超链接的部分文本值来获取元素</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 有2中方式定位，推荐使用第二种，通过By来选择</span></span><br><span class="line">driver.findElementById(<span class="string">&quot;kw&quot;</span>).sendKeys(<span class="string">&quot;腾讯&quot;</span>);<span class="comment">//方法一：定位输入框输入腾讯</span></span><br><span class="line">driver.findElement(By.id(<span class="string">&quot;kw&quot;</span>)).sendKeys(<span class="string">&quot;腾讯视频&quot;</span>);<span class="comment">//方法二：定位输入框输入腾讯</span></span><br><span class="line">driver.findElement(By.tagName(<span class="string">&quot;input&quot;</span>)).sendKeys(<span class="string">&quot;腾讯视频&quot;</span>);<span class="comment">// 定位input标签输入 腾讯视频。不推荐，因为可能有多个input，但只定位到第一个，不准确</span></span><br><span class="line"></span><br><span class="line">driver.findElement(By.className(<span class="string">&quot;btn&quot;</span>)).click();<span class="comment">// 注意：这里不能出现复合类名，会报错；只能出现一个类名</span></span><br><span class="line"><span class="comment">// driver.findElement(By.className(&quot;btn wt_w&quot;)).click(); //这样写会报Comound class names not permitted--&gt;复合类名问题</span></span><br><span class="line"></span><br><span class="line">driver.findElement(By.linkText(<span class="string">&quot;地图&quot;</span>)).click();<span class="comment">// 定位超链接中有”地图“元素，并打开--》超链接完整文本</span></span><br><span class="line">driver.findElement(By.partialLinkText(<span class="string">&quot;图&quot;</span>)).click();<span class="comment">// 定位超链接中有”地图“元素，并打开--》超链接部分文本</span></span><br></pre></td></tr></table></figure>

<h3 id="cssSelector定位"><a href="#cssSelector定位" class="headerlink" title="cssSelector定位"></a>cssSelector定位</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 和css选择器一样 例：</span></span><br><span class="line">driver.findElement(By.cssSelector(<span class="string">&quot;#btn&quot;</span>)).click();	<span class="comment">//定位id=btn，并点击</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//class有区别，如果是多个class，不能用空格来代替，必须每个前面都要加点</span></span><br><span class="line">driver.findElement(By.cssSelector(<span class="string">&quot;.btn.bg&quot;</span>)).click();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>css精确定位</p>
</blockquote>
<p>By.cssSelector(“标签名[属性名&#x3D;’属性值’] [属性名&#x3D;’属性值’]”)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.findElement(By.cssSelector(<span class="string">&quot;input[maxlength=255]&quot;</span>)).sendKeys(<span class="string">&quot;雨课堂&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="xpath定位"><a href="#xpath定位" class="headerlink" title="xpath定位"></a>xpath定位</h3><ul>
<li><p>绝对定位</p>
<p>从根开始找—  &#x2F;(根目录)</p>
<p>&#x2F;html&#x2F;body&#x2F;div[2]div&#x2F;form&#x2F;div[5]&#x2F;button</p>
<p>缺点：一旦页面结构发生变化，该路径就失效了</p>
</li>
<li><p>相对路径</p>
<p>xpath相对路径：只要不是&#x2F;开始的，就是相对路径</p>
<p>&#x2F;&#x2F;*[@name&#x3D;’phone’]</p>
<p>路径解释：</p>
<ul>
<li>&#x2F;&#x2F; ：匹配指定节点，不考虑它们位置（&#x2F;表示绝对路径，从根下开始）</li>
<li>*：通配符，匹配任意元素节点</li>
<li>@：选取属性</li>
<li>[]：属性判断条件表达式</li>
</ul>
<p>优点：灵活、方便、耦合性低</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">driver.findElement(By.xpath(<span class="string">&quot;//input[@maxlength=&#x27;100&#x27;] and @autocomplete=&#x27;off&#x27;&quot;</span>)).sendKeys(<span class="string">&quot;腾讯&quot;</span>);	<span class="comment">//选取多个属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//完整文本</span></span><br><span class="line">driver.findElement(By.xpath(<span class="string">&quot;//a[text()=&#x27;新闻&#x27;]&quot;</span>)).click();<span class="comment">//text()是表达式</span></span><br><span class="line"><span class="comment">//部分文本</span></span><br><span class="line">driver.findElement(By.xpath(<span class="string">&quot;//a[contains(text(),&#x27;文&#x27;)]&quot;</span>)).click();<span class="comment">//text()、contains()是表达式</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><h3 id="元素操作API"><a href="#元素操作API" class="headerlink" title="元素操作API"></a>元素操作API</h3><ul>
<li><p>click()：触发当前元素的点击事件</p>
</li>
<li><p>clear()：清空内容</p>
</li>
<li><p>sendKeys()：往文本框一类元素中写入内容</p>
<p>按键操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">driver.sendKeys(Keys.CONTROL,<span class="string">&quot;a&quot;</span>);<span class="comment">//ctrl+a</span></span><br><span class="line">driver.sendKeys(Keys.CONTROL,<span class="string">&quot;x&quot;</span>);<span class="comment">//ctrl+x</span></span><br><span class="line">driver.sendKeys(Keys.ENTER);<span class="comment">//回车</span></span><br><span class="line">driver.sendKeys(Keys.BACK_SPACE);<span class="comment">//删除</span></span><br><span class="line">driver.sendKeys(Keys.SPACE);<span class="comment">//空格</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>getTagName()：获取元素的标签名</p>
</li>
<li><p>getAttribute(属性名)：根据属性名获取元素属性值</p>
</li>
<li><p>getText()：获取当前元素文本值</p>
</li>
<li><p>isDisplayed()：查看元素是否显示</p>
</li>
</ul>
<h3 id="WebDriver-API"><a href="#WebDriver-API" class="headerlink" title="WebDriver API"></a>WebDriver API</h3><ul>
<li><p>get(String url)：访问指定url页面</p>
</li>
<li><p>getCurrentUrl()：获取当前页面的url地址</p>
</li>
<li><p>getTitle()：获取当前页面的标题</p>
</li>
<li><p>getPageSource()：获取当前页面源代码</p>
</li>
<li><p>quit()：关闭驱动对象以及所有相关的窗口</p>
</li>
<li><p>close()：关闭当前窗口</p>
</li>
<li><p>getWindowHandle()：返回当前页面句柄</p>
</li>
<li><p>getWindowHandles()：返回所有由驱动对象打开页面所有的句柄</p>
</li>
<li><p>manage()：获取Options—浏览器菜单操作对象</p>
<p>driver.manage().window()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Options options=driver.manage();</span><br><span class="line">Dimension dimension=options.window().getSize();<span class="comment">//获取窗口的宽高</span></span><br><span class="line">System.out.println(<span class="string">&quot;窗口高度: &quot;</span>+dimension.getHeight());</span><br><span class="line">System.out.println(<span class="string">&quot;窗口宽度: &quot;</span>+dimension.getWidht());</span><br></pre></td></tr></table></figure>
</li>
<li><p>navigate对象</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取navigate对象</span></span><br><span class="line">Navigation navigation=driver.navigate();</span><br><span class="line"><span class="comment">// 访问指定的url地址</span></span><br><span class="line">navigation.ro(url);</span><br><span class="line"><span class="comment">// 刷新当前页面</span></span><br><span class="line">navigation.refresh();</span><br><span class="line"><span class="comment">// 浏览器回退操作</span></span><br><span class="line">navigation.back();</span><br><span class="line"><span class="comment">// 浏览器前进操作</span></span><br><span class="line">navigation.forward();</span><br></pre></td></tr></table></figure>

<h2 id="三种等待方式"><a href="#三种等待方式" class="headerlink" title="三种等待方式"></a>三种等待方式</h2><blockquote>
<p>硬性等待</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Thread.sleep(<span class="number">3000</span>);<span class="comment">//睡眠3秒</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>隐式等待</p>
</blockquote>
<p>在设置的超时时间范围内不断查找元素，知道找到元素或则超时为止</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//driver.manage.timeouts.implicitlyWait(long time,TimeUnit unit);</span></span><br><span class="line"><span class="comment">//设置超时时间为5秒</span></span><br><span class="line">driver.manage.timeouts.implicitlyWait(<span class="number">5</span>,TimeUnit.SECONDS);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>显示等待</p>
</blockquote>
<p>用来等待某个条件发生后再继续执行后续代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WebDriverWait wait= new WebDriverWait(WebDriver driver,long timeOutInSeconds);</span><br><span class="line">WebElement element=wait.until(expectCondition);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>方法</th>
<th>等待条件</th>
</tr>
</thead>
<tbody><tr>
<td>visibilityOfElementLocated(By locator)</td>
<td>页面元素在页面存在并且可见</td>
</tr>
<tr>
<td>elementToBeClickable(By locator)</td>
<td>页面元素是否在页面上可用和可被单击</td>
</tr>
<tr>
<td>elementToBeSelected(WebElement element)</td>
<td>页面元素处于被选中状态</td>
</tr>
<tr>
<td>textToBePresentlnElement(By locator)</td>
<td>在页面元素中是否包含特定的文本</td>
</tr>
<tr>
<td>presenceOfElementLocated(By locator)</td>
<td>页面元素在页面中存在</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建显示等待，超时时间为5秒</span></span><br><span class="line">WebDriverWait wait= <span class="keyword">new</span> <span class="title class_">WebDriverWait</span>(driver,<span class="number">5</span>);</span><br><span class="line"><span class="comment">// 查询元素</span></span><br><span class="line">wait.until(ExpectConditions.visibilityOfElementLocated(By.xpath(<span class="string">&quot;//a[text(=&#x27;腾讯&#x27;)]&quot;</span>)));</span><br><span class="line"><span class="comment">// 显示出来后点击该元素</span></span><br><span class="line">driver.findElement(By.xpath(<span class="string">&quot;//a[text(=&#x27;腾讯&#x27;)]&quot;</span>)).click();</span><br></pre></td></tr></table></figure>

<h2 id="特殊元素定位与操作"><a href="#特殊元素定位与操作" class="headerlink" title="特殊元素定位与操作"></a>特殊元素定位与操作</h2><h3 id="模态框"><a href="#模态框" class="headerlink" title="模态框"></a>模态框</h3><p>Modal Dialogue Box，又叫做模式对话框，是指在用户想要对对话框以外的应用程序进行操作时，必须首先对该对话框进行响应。如单击【确定】或【取消】按钮等将该对话框关闭。</p>
<ul>
<li>alert</li>
<li>confirm</li>
</ul>
<p>alert处理：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testEdge</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//设置webdriver.edge.driver属性</span></span><br><span class="line">    System.setProperty(<span class="string">&quot;webdriver.edge.driver&quot;</span>,<span class="string">&quot;driver/msedgedriver.exe&quot;</span>);  </span><br><span class="line">    <span class="comment">//打开edge浏览器</span></span><br><span class="line">    <span class="type">EdgeDriver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EdgeDriver</span>();</span><br><span class="line">    <span class="comment">//打开一个alert页面</span></span><br><span class="line">    driver.get(<span class="string">&quot;D:\\练习素材\\alert.html&quot;</span>); </span><br><span class="line">    <span class="comment">// 点击按钮</span></span><br><span class="line">    driver.findElement(By.id(<span class="string">&quot;abtn&quot;</span>)).click();</span><br><span class="line">    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">    <span class="comment">// switchTo.alert 找到对应的alert弹框</span></span><br><span class="line">    <span class="type">Alert</span> <span class="variable">alert</span> <span class="operator">=</span> driver.switchTo.alert();</span><br><span class="line">    <span class="comment">// alert.accept() // 点击确定</span></span><br><span class="line">    <span class="comment">//alert.dismiss() // 取消</span></span><br><span class="line">    System.out.println(alert.getText());<span class="comment">// 获取alert上的文本信息 </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>confirm处理：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testEdge</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//设置webdriver.edge.driver属性</span></span><br><span class="line">    System.setProperty(<span class="string">&quot;webdriver.edge.driver&quot;</span>,<span class="string">&quot;driver/msedgedriver.exe&quot;</span>);  </span><br><span class="line">    <span class="comment">//打开edge浏览器</span></span><br><span class="line">    <span class="type">EdgeDriver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EdgeDriver</span>();</span><br><span class="line">    <span class="comment">//打开一个confirm页面</span></span><br><span class="line">    driver.get(<span class="string">&quot;D:\\练习素材\\confirm.html&quot;</span>); </span><br><span class="line">    <span class="comment">// 点击按钮</span></span><br><span class="line">    driver.findElement(By.id(<span class="string">&quot;abtn&quot;</span>)).click();</span><br><span class="line">    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">    <span class="comment">// switchTo.alert 找到对应的confirm弹框</span></span><br><span class="line">    <span class="type">Alert</span> <span class="variable">alert</span> <span class="operator">=</span> driver.switchTo.alert();</span><br><span class="line">    <span class="comment">// alert.accept() // 点击确定</span></span><br><span class="line">    <span class="comment">//alert.dismiss() // 取消</span></span><br><span class="line">    System.out.println(alert.getText());<span class="comment">// 获取confirm上的文本信息 </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="iframe"><a href="#iframe" class="headerlink" title="iframe"></a>iframe</h3><p>iframe四种切换方式：</p>
<ul>
<li>driver.switchTo().frame(index);</li>
<li>driver.swtichTo().frame(id);</li>
<li>driver.switchTo().frame(name);</li>
<li>driver.switchTo().frame(WebElement);</li>
</ul>
<p>切换之后，回到默认内容页面（否则会找不到元素）</p>
<p> driver.switchTo().defaultContent();</p>
<h3 id="window"><a href="#window" class="headerlink" title="window"></a>window</h3><p>当你要操作另外一个窗口页面的元素时，一定要注意先切换窗口切换方式:传入要操作窗口的name或者句柄handle</p>
<p>driver.switchTo.window(nameOrHandle);</p>
<p>如何获取到窗口的句柄：</p>
<ul>
<li><p>driver.getWindowHandle();&#x2F;l获取当前操作窗口的句柄</p>
</li>
<li><p>driver.getWindowHandles();&#x2F;&#x2F;获取测试时打开的所有窗口句柄</p>
</li>
</ul>
<h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><p>如果页面元素是一个不拉框，我们可以将此web元素封装为Select对象.</p>
<ul>
<li>Select select &#x3D; new Select(WebElement element);</li>
</ul>
<p>Select对象常用api</p>
<ul>
<li><p>select.getOptions();	&#x2F;&#x2F;获取所有选项</p>
</li>
<li><p>select.selectBylndex(index);    &#x2F;&#x2F;根据索引选中对应的元素</p>
</li>
<li><p>select.selectByValue(value);     &#x2F;&#x2F;选择指定value值对应的选项</p>
</li>
<li><p>select.selectByVisibleText(text);    &#x2F;&#x2F;选中文本值对应的选项</p>
</li>
</ul>
<p>select处理：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testEdge</span><span class="params">()</span> &#123;</span><br><span class="line">        System.setProperty(<span class="string">&quot;webdriver.edge.driver&quot;</span>,<span class="string">&quot;driver/msedgedriver.exe&quot;</span>);   </span><br><span class="line">        <span class="type">EdgeDriver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EdgeDriver</span>();<span class="comment">//打开edge浏览器</span></span><br><span class="line">        driver.get(<span class="string">&quot;https://www.baidu.com/&quot;</span>); 	<span class="comment">//打开百度</span></span><br><span class="line">        <span class="comment">// select 下拉框处理</span></span><br><span class="line">        driver.findElement(By.xpath(<span class="string">&quot;//div[@id=&#x27;u1&#x27;/a[text()=&#x27;设置&#x27;]]&quot;</span>)).click();<span class="comment">//点击设置</span></span><br><span class="line">        driver.findElement(By.xpath(<span class="string">&quot;//a[text()=&#x27;高级搜索&#x27;]&quot;</span>)).click();<span class="comment">//点击高级设置</span></span><br><span class="line">        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        <span class="comment">// 定位时间下拉框</span></span><br><span class="line">        WebElement element=driver.findElement(By.name(<span class="string">&#x27;gpc&#x27;</span>));</span><br><span class="line">        <span class="comment">// 把WebElement 封装成Select对象</span></span><br><span class="line">        <span class="type">Select</span> <span class="variable">select</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Select</span>(element);</span><br><span class="line">        <span class="comment">//select 下拉框索引值从0开始</span></span><br><span class="line">        select.selectByIndex(<span class="number">1</span>);<span class="comment">// 选中第一个</span></span><br><span class="line">        select.selectByVisibleText(<span class="string">&quot;最近一天&quot;</span>);<span class="comment">//选中文本值为 “最近一天”  </span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="时间日期控件"><a href="#时间日期控件" class="headerlink" title="时间日期控件"></a>时间日期控件</h3><p>分为两种情况：</p>
<ul>
<li><p>控件没有限制手动输入，则直接调用sendKeys方法写入时间数据</p>
</li>
<li><p>控件有限制输入，则可以执行一段js来改变元素的value属性值</p>
<p>JavascriptExecutor jsExecutor&#x3D;(JavascriptExecutor) driver;</p>
<p>jsExecutor.executeScript(“.”);</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDate</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    System.setProperty(<span class="string">&quot;webdriver.edge.driver&quot;</span>,<span class="string">&quot;driver/msedgedriver.exe&quot;</span>);</span><br><span class="line">    <span class="type">EdgeDriver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EdgeDriver</span>();</span><br><span class="line">    driver.get(<span class="string">&quot;https://www.12306.cn/index/&quot;</span>);</span><br><span class="line">    <span class="comment">// 转化为JavascriptExecutor执行对象</span></span><br><span class="line">    JavascriptExecutor jsExecutor=driver;</span><br><span class="line">    <span class="comment">// 执行js代码</span></span><br><span class="line">    jsExecutor.executeScript(<span class="string">&quot;document.getElementById(&#x27;train_date&#x27;).removeAttribute(&#x27;readonly&#x27;)&quot;</span>);</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    <span class="comment">// 清除文本信息</span></span><br><span class="line">    driver.findElement(By.id(<span class="string">&quot;train_date&quot;</span>)).clear();</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    driver.findElement(By.id(<span class="string">&quot;train_date&quot;</span>)).sendKeys(<span class="string">&quot;2020-10-10&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="鼠标操作"><a href="#鼠标操作" class="headerlink" title="鼠标操作"></a>鼠标操作</h3><p>自动化测试时，有些元素不适合直接点击或者进行某些操作时，可以使用Selenium的Actions类来模拟鼠标键盘操作，通过Actions对象可以发起鼠标左键、右键、移动鼠标等操作，最后使用perform方法执行操作。</p>
<p>actions.clickAndHold(onElement).moveToElement(toElement).release().build().rerform();</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMouse</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    System.setProperty(<span class="string">&quot;webdriver.edge.driver&quot;</span>,<span class="string">&quot;driver/msedgedriver.exe&quot;</span>);</span><br><span class="line">    <span class="type">EdgeDriver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EdgeDriver</span>();</span><br><span class="line">    driver.get(<span class="string">&quot;http://www.treejs.cn/v3/demo/cn/exedit/drag.html&quot;</span>);</span><br><span class="line">    <span class="type">WebElement</span> <span class="variable">sourceElement</span> <span class="operator">=</span> driver.findElement(By.id(<span class="string">&quot;treeDemo_2_span&quot;</span>));</span><br><span class="line">    <span class="type">WebElement</span> <span class="variable">targetElement</span> <span class="operator">=</span> driver.findElement(By.id(<span class="string">&quot;treeDemo_3_span&quot;</span>));</span><br><span class="line">    <span class="comment">//实例化actions对象，鼠标的相关操作</span></span><br><span class="line">    <span class="type">Actions</span> <span class="variable">actions</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Actions</span>(driver);</span><br><span class="line">    <span class="comment">//将sourceElement移动到targetElement位置下</span></span><br><span class="line">    actions.clickAndHold(sourceElement).moveToElement(targetElement).release().build().perform();<span class="comment">//release().build().perform():固定格式</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><p>分为两种情况:</p>
<ul>
<li><p>类似于下面，使用sendKeys写入文件的路径</p>
<input type="file" id="fu" value="选择文件" >
</li>
<li><p>如果文件上传不是input元素，而是使用的第三方的控件。并且不是input<br>元素，那么这种情况就很棘手了，必须要使用一些第三方的工具，比如autoit等来完成。</p>
</li>
</ul>
<h3 id="验证码"><a href="#验证码" class="headerlink" title="验证码"></a>验证码</h3><ul>
<li>取除验证码</li>
<li>自动识别</li>
<li>万能验证码（推荐）</li>
</ul>

    </div>

    
    
    
        <div class="reward-container">
  <div>原创技术分享，您的支持将鼓励我继续创作</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="SupremeSu 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="SupremeSu 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>SupremeSu
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://example.com/2022/06/02/crawler/" title="java爬虫笔记">http://example.com/2022/06/02/crawler/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/06/02/SpringBoot/" rel="prev" title="SpringBoot学习笔记">
      <i class="fa fa-chevron-left"></i> SpringBoot学习笔记
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/06/02/Mybatis/" rel="next" title="Mybatis笔记">
      Mybatis笔记 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="SOHUCS"></div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="nav-number">1.</span> <span class="nav-text">入门案例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HeepClient"><span class="nav-number">2.</span> <span class="nav-text">HeepClient</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#GET-%E8%AF%B7%E6%B1%82"><span class="nav-number">2.1.</span> <span class="nav-text">GET 请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#POST%E8%AF%B7%E6%B1%82"><span class="nav-number">2.2.</span> <span class="nav-text">POST请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="nav-number">2.3.</span> <span class="nav-text">连接池</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="nav-number">2.4.</span> <span class="nav-text">请求参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Jsoup"><span class="nav-number">3.</span> <span class="nav-text">Jsoup</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90url"><span class="nav-number">3.1.</span> <span class="nav-text">解析url</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">3.2.</span> <span class="nav-text">解析字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90%E6%96%87%E4%BB%B6"><span class="nav-number">3.3.</span> <span class="nav-text">解析文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8DOM%E6%96%B9%E5%BC%8F%E9%81%8D%E5%8E%86%E6%96%87%E6%A1%A3"><span class="nav-number">3.4.</span> <span class="nav-text">使用DOM方式遍历文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#selector%E9%80%89%E6%8B%A9%E5%99%A8"><span class="nav-number">3.5.</span> <span class="nav-text">selector选择器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#selector-%E9%80%89%E6%8B%A9%E5%99%A8%E7%BB%84%E5%90%88%E4%BD%BF%E7%94%A8"><span class="nav-number">3.6.</span> <span class="nav-text">selector 选择器组合使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%88%AC%E8%99%AB%E6%A1%88%E4%BE%8B"><span class="nav-number">4.</span> <span class="nav-text">爬虫案例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WebMagic"><span class="nav-number"></span> <span class="nav-text">WebMagic</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B-1"><span class="nav-number">1.</span> <span class="nav-text">入门案例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WebMagic%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.</span> <span class="nav-text">WebMagic介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WebMagic%E4%BB%8B%E7%BB%8D-1"><span class="nav-number">2.1.</span> <span class="nav-text">WebMagic介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%B6%E6%9E%84%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.2.</span> <span class="nav-text">架构介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WebMagic%E7%9A%84%E5%9B%9B%E4%B8%AA%E7%BB%84%E4%BB%B6"><span class="nav-number">2.3.</span> <span class="nav-text">WebMagic的四个组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E4%BA%8E%E6%95%B0%E6%8D%AE%E6%B5%81%E8%BD%AC%E7%9A%84%E5%AF%B9%E8%B1%A1"><span class="nav-number">2.4.</span> <span class="nav-text">用于数据流转的对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-Request"><span class="nav-number">2.4.1.</span> <span class="nav-text">1. Request</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Page"><span class="nav-number">2.4.2.</span> <span class="nav-text">2. Page</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-ResultItems"><span class="nav-number">2.4.3.</span> <span class="nav-text">3. ResultItems</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E5%9F%BA%E6%9C%AC%E7%9A%84%E7%88%AC%E8%99%AB"><span class="nav-number">3.</span> <span class="nav-text">编写基本的爬虫</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0PageProcessor"><span class="nav-number">3.1.</span> <span class="nav-text">实现PageProcessor</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%88%AC%E8%99%AB%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-number">3.1.1.</span> <span class="nav-text">爬虫的配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A1%B5%E9%9D%A2%E5%85%83%E7%B4%A0%E7%9A%84%E6%8A%BD%E5%8F%96"><span class="nav-number">3.1.2.</span> <span class="nav-text">页面元素的抽取</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%93%BE%E6%8E%A5%E7%9A%84%E5%8F%91%E7%8E%B0"><span class="nav-number">3.1.3.</span> <span class="nav-text">链接的发现</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Selectable%E6%8A%BD%E5%8F%96%E5%85%83%E7%B4%A0"><span class="nav-number">3.2.</span> <span class="nav-text">使用Selectable抽取元素</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%BD%E5%8F%96%E9%83%A8%E5%88%86API%EF%BC%9A"><span class="nav-number">3.2.1.</span> <span class="nav-text">抽取部分API：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E7%BB%93%E6%9E%9C%E7%9A%84API%EF%BC%9A"><span class="nav-number">3.2.2.</span> <span class="nav-text">获取结果的API：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Pipeline%E4%BF%9D%E5%AD%98%E7%BB%93%E6%9E%9C"><span class="nav-number">3.3.</span> <span class="nav-text">使用Pipeline保存结果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%88%AC%E8%99%AB%E7%9A%84%E9%85%8D%E7%BD%AE%E3%80%81%E5%90%AF%E5%8A%A8%E5%92%8C%E7%BB%88%E6%AD%A2"><span class="nav-number">3.4.</span> <span class="nav-text">爬虫的配置、启动和终止</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86-beta"><span class="nav-number">3.5.</span> <span class="nav-text">配置代理(beta)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%84%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8%E5%92%8C%E5%AE%9A%E5%88%B6"><span class="nav-number">4.</span> <span class="nav-text">组件的使用和定制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%92%8C%E5%AE%9A%E5%88%B6Pipeline"><span class="nav-number">4.1.</span> <span class="nav-text">使用和定制Pipeline</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Pipeline%E4%BB%8B%E7%BB%8D"><span class="nav-number">4.1.1.</span> <span class="nav-text">Pipeline介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%86%E7%BB%93%E6%9E%9C%E8%BE%93%E5%87%BA%E5%88%B0%E6%8E%A7%E5%88%B6%E5%8F%B0"><span class="nav-number">4.1.2.</span> <span class="nav-text">将结果输出到控制台</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%86%E7%BB%93%E6%9E%9C%E4%BF%9D%E5%AD%98%E5%88%B0MySQL"><span class="nav-number">4.1.3.</span> <span class="nav-text">将结果保存到MySQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3%E6%A8%A1%E5%BC%8F"><span class="nav-number">4.1.4.</span> <span class="nav-text">注解模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E6%9C%ACPipeline%E6%A8%A1%E5%BC%8F"><span class="nav-number">4.1.5.</span> <span class="nav-text">基本Pipeline模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WebMagic%E5%B7%B2%E7%BB%8F%E6%8F%90%E4%BE%9B%E7%9A%84%E5%87%A0%E4%B8%AAPipeline"><span class="nav-number">4.1.6.</span> <span class="nav-text">WebMagic已经提供的几个Pipeline</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F"><span class="nav-number">4.1.7.</span> <span class="nav-text">注意</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%92%8C%E5%AE%9A%E5%88%B6Scheduler"><span class="nav-number">4.2.</span> <span class="nav-text">使用和定制Scheduler</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%92%8C%E5%AE%9A%E5%88%B6Downloader"><span class="nav-number">4.3.</span> <span class="nav-text">使用和定制Downloader</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8B%9B%E8%81%98%E7%BD%91%E7%AB%99%E7%88%AC%E5%8F%96%E5%AE%8C%E6%95%B4%E6%A1%88%E4%BE%8B"><span class="nav-number">5.</span> <span class="nav-text">招聘网站爬取完整案例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E6%8A%80%E5%B7%A7"><span class="nav-number">6.</span> <span class="nav-text">小技巧</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#selenium"><span class="nav-number"></span> <span class="nav-text">selenium</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#selenium%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.</span> <span class="nav-text">selenium介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Selenium-WebDriver"><span class="nav-number">2.</span> <span class="nav-text">Selenium WebDriver</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%83%E7%B4%A0%E5%AE%9A%E4%BD%8D"><span class="nav-number">3.</span> <span class="nav-text">元素定位</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E5%85%83%E7%B4%A0%E5%AE%9A%E4%BD%8D"><span class="nav-number">3.1.</span> <span class="nav-text">基本元素定位</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cssSelector%E5%AE%9A%E4%BD%8D"><span class="nav-number">3.2.</span> <span class="nav-text">cssSelector定位</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#xpath%E5%AE%9A%E4%BD%8D"><span class="nav-number">3.3.</span> <span class="nav-text">xpath定位</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#API"><span class="nav-number">4.</span> <span class="nav-text">API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%83%E7%B4%A0%E6%93%8D%E4%BD%9CAPI"><span class="nav-number">4.1.</span> <span class="nav-text">元素操作API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WebDriver-API"><span class="nav-number">4.2.</span> <span class="nav-text">WebDriver API</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E7%A7%8D%E7%AD%89%E5%BE%85%E6%96%B9%E5%BC%8F"><span class="nav-number">5.</span> <span class="nav-text">三种等待方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E5%85%83%E7%B4%A0%E5%AE%9A%E4%BD%8D%E4%B8%8E%E6%93%8D%E4%BD%9C"><span class="nav-number">6.</span> <span class="nav-text">特殊元素定位与操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E6%80%81%E6%A1%86"><span class="nav-number">6.1.</span> <span class="nav-text">模态框</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iframe"><span class="nav-number">6.2.</span> <span class="nav-text">iframe</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#window"><span class="nav-number">6.3.</span> <span class="nav-text">window</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#select"><span class="nav-number">6.4.</span> <span class="nav-text">select</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F%E6%8E%A7%E4%BB%B6"><span class="nav-number">6.5.</span> <span class="nav-text">时间日期控件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%BC%A0%E6%A0%87%E6%93%8D%E4%BD%9C"><span class="nav-number">6.6.</span> <span class="nav-text">鼠标操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">6.7.</span> <span class="nav-text">文件上传</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="nav-number">6.8.</span> <span class="nav-text">验证码</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="SupremeSu"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">SupremeSu</p>
  <div class="site-description" itemprop="description">宁愿犯错，也不愿什么都不做</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2022 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">SupremeSu</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>



        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  <script>
  NexT.utils.loadComments(document.querySelector('#SOHUCS'), () => {
    var appid = 'cyw6tI0Dp';
    var conf = '9266586296b349b381adadc1aa1e923b';
    var width = window.innerWidth || document.documentElement.clientWidth;
    if (width < 960) {
      window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>');
    } else {
      var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})});
    }
  });
  </script>
  <script src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js"></script>

</body>
</html>
